var V=Object.defineProperty,Y=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var T=(e,t,s)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,P=(e,t)=>{for(var s in t||(t={}))B.call(t,s)&&T(e,s,t[s]);if(D)for(var s of D(t))H.call(t,s)&&T(e,s,t[s]);return e},q=(e,t)=>Y(e,_(t));import{I as $,J as b,L as K,O as G,M as z,N as F,P as Z,Q as ee,R as te,T as ne,U as se,V as oe,W as U,E as re,X as k,Y as ie,D as ce}from"./vendor.b8b0b9ef.js";const A={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new $({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:b.WebMercator}),minus180Line:new $({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:b.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new $({paths:[[[180,-180],[180,180]]],spatialReference:b.WGS84}),minus180Line:new $({paths:[[[-180,-180],[-180,180]]],spatialReference:b.WGS84})}};function S(e,t){return Math.ceil((e-t)/(2*t))}function Q(e,t){const s=I(e);for(const o of s)for(const n of o)n[0]+=t;return e}function I(e){return K(e)?e.rings:e.paths}async function fe(e,t,s,o){const n=typeof e=="string"?G(e):e,i=t[0].spatialReference,u=q(P({},o),{query:q(P({},n.query),{f:"json",sr:JSON.stringify(i),target:JSON.stringify({geometryType:z(t[0]),geometries:t}),cutter:JSON.stringify(s)})}),c=await F(n.path+"/cut",u),{cutIndexes:a,geometries:m=[]}=c.data;return{cutIndexes:a,geometries:m.map(l=>{const x=Z(l);return x.spatialReference=i,x})}}async function ae(e,t,s){const o=typeof e=="string"?G(e):e,n=t[0].spatialReference,i=z(t[0]),u=q(P({},s),{query:q(P({},o.query),{f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(le(t))})});return ue((await F(o.path+"/simplify",u)).data,i,n)}function le(e){return{geometryType:z(e[0]),geometries:e.map(t=>t.toJSON())}}function ue(e,t,s){const o=ee(t);return e.map(n=>{const i=o.fromJSON(n);return i.spatialReference=s,i})}const pe=te.getLogger("esri.geometry.support.normalizeUtils");function he(e){return e.type==="polygon"}function ge(e){return e[0].type==="polygon"}function me(e){return e[0].type==="polyline"}function ye(e,t){if(!(e instanceof $||e instanceof U)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw pe.error(n),new ce(n)}const s=I(e),o=[];for(const n of s){const i=[];o.push(i),i.push([n[0][0],n[0][1]]);for(let u=0;u<n.length-1;u++){const c=n[u][0],a=n[u][1],m=n[u+1][0],l=n[u+1][1],x=Math.sqrt((m-c)*(m-c)+(l-a)*(l-a)),y=(l-a)/x,h=(m-c)/x,d=x/t;if(d>1){for(let J=1;J<=d-1;J++){const M=J*t,O=h*M+c,r=y*M+a;i.push([O,r])}const p=(x+Math.floor(d-1)*t)/2,L=h*p+c,N=y*p+a;i.push([L,N])}i.push([m,l])}}return he(e)?new U({rings:o,spatialReference:e.spatialReference}):new $({paths:o,spatialReference:e.spatialReference})}function C(e,t,s){if(t){const o=ye(e,1e6);e=ie(o,!0)}return s&&(e=Q(e,s)),e}function E(e,t,s){if(Array.isArray(e)){const o=e[0];if(o>t){const n=S(o,t);e[0]=o+n*(-2*t)}else if(o<s){const n=S(o,s);e[0]=o+n*(-2*s)}}else{const o=e.x;if(o>t){const n=S(o,t);e=e.clone().offset(n*(-2*t),0)}else if(o<s){const n=S(o,s);e=e.clone().offset(n*(-2*s),0)}}return e}function xe(e,t){let s=-1;for(let o=0;o<t.cutIndexes.length;o++){const n=t.cutIndexes[o],i=t.geometries[o],u=I(i);for(let c=0;c<u.length;c++){const a=u[c];a.some(m=>{if(m[0]<180)return!0;{let l=0;for(let y=0;y<a.length;y++){const h=a[y][0];l=h>l?h:l}l=Number(l.toFixed(9));const x=-360*S(l,180);for(let y=0;y<a.length;y++){const h=i.getPoint(c,y);i.setPoint(c,y,h.clone().offset(x,0))}return!0}})}if(n===s){if(ge(e))for(const c of I(i))e[n]=e[n].addRing(c);else if(me(e))for(const c of I(i))e[n]=e[n].addPath(c)}else s=n,e[n]=i}return e}async function de(e,t,s){var o;if(!Array.isArray(e))return de([e],t);const n=(o=t==null?void 0:t.url)!=null?o:ne.geometryServiceUrl;let i,u,c,a,m,l,x,y,h=0;const d=[],p=[];for(const r of e)if(se(r))p.push(r);else if(i||(i=r.spatialReference,u=oe(i),c=i.isWebMercator,l=c?102100:4326,a=A[l].maxX,m=A[l].minX,x=A[l].plus180Line,y=A[l].minus180Line),u)if(r.type==="mesh")p.push(r);else if(r.type==="point")p.push(E(r.clone(),a,m));else if(r.type==="multipoint"){const f=r.clone();f.points=f.points.map(g=>E(g,a,m)),p.push(f)}else if(r.type==="extent"){const f=r.clone()._normalize(!1,!1,u);p.push(f.rings?new U(f):f)}else if(r.extent){const f=r.extent,g=S(f.xmin,m)*(2*a);let w=g===0?r.clone():Q(r.clone(),g);f.offset(g,0),f.intersects(x)&&f.xmax!==a?(h=f.xmax>h?f.xmax:h,w=C(w,c),d.push(w),p.push("cut")):f.intersects(y)&&f.xmin!==m?(h=f.xmax*(2*a)>h?f.xmax*(2*a):h,w=C(w,c,360),d.push(w),p.push("cut")):p.push(w)}else p.push(r.clone());else p.push(r);let L=S(h,a),N=-90;const J=L,M=new $;for(;L>0;){const r=360*L-180;M.addPath([[r,N],[r,-1*N]]),N*=-1,L--}if(d.length>0&&J>0){const r=xe(d,await fe(n,d,M,s)),f=[],g=[];for(let R=0;R<p.length;R++){const X=p[R];if(X!=="cut")g.push(X);else{const W=r.shift(),v=e[R];re(v)&&v.type==="polygon"&&v.rings&&v.rings.length>1&&W.rings.length>=v.rings.length?(f.push(W),g.push("simplify")):g.push(c?k(W):W)}}if(!f.length)return g;const w=await ae(n,f,s),j=[];for(let R=0;R<g.length;R++){const X=g[R];X!=="simplify"?j.push(X):j.push(c?k(w.shift()):w.shift())}return j}const O=[];for(let r=0;r<p.length;r++){const f=p[r];if(f!=="cut")O.push(f);else{const g=d.shift();O.push(c===!0?k(g):g)}}return Promise.resolve(O)}export{de as v};
