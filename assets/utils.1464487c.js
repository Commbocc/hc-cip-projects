var ut=Object.defineProperty,pt=Object.defineProperties;var xt=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var mt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var J=(t,n,s)=>n in t?ut(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,Q=(t,n)=>{for(var s in n||(n={}))mt.call(n,s)&&J(t,s,n[s]);if(H)for(var s of H(n))ht.call(n,s)&&J(t,s,n[s]);return t},U=(t,n)=>pt(t,xt(n));import{a5 as _,U as yt,bo as K,E as z,bb as R,D as dt,_ as h,$ as T,a0 as L,ap as gt,bB as E,bz as V,bv as Z}from"./vendor.b8b0b9ef.js";import{J as it,O as wt,Q as q,l as vt}from"./projection.4e77876b.js";const G=5e-4;function Mt(t,n,s){return!vt(t,n,s)}function j(t,n,s){const o=Mt(t,n,s);if(o&&!it())throw new dt("rasterprojectionhelper-project","projection engine is not loaded");return o}const tt=function(t,n,s){const o=(t[0]+t[4]+t[4*n.cols]+t[4*n.cols+4])/4,r=(t[1]+t[5]+t[4*n.rows+1]+t[4*n.rows+5])/4,e=(t[4*n.cols]-t[0]+t[4*n.cols+4]-t[4])/s[0]*.5,i=(t[4*n.cols+1]-t[1]+t[4*n.cols+5]-t[5])/s[1]*.5;return[e===0||isNaN(e)?0:Math.abs(o-t[2*n.rows+2])/Math.abs(e),i===0||isNaN(i)?0:Math.abs(r-t[2*n.rows+3])/Math.abs(i)]},Ct={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},k=32,A=4,Rt=A;async function Wt(){if(it())return null;await wt()}function Ft(t,n,s,o=null){if(t.spatialReference.equals(n))return t;j(t.spatialReference,n,o);const r=s.center,e=new _({xmin:r.x-t.x/2,xmax:r.x+t.x/2,ymin:r.y-t.y/2,ymax:r.y+t.y/2,spatialReference:t.spatialReference}),i=q(e,n,o);return yt(i)?null:{x:i.xmax-i.xmin,y:i.ymax-i.ymin}}function at(t,n=.01){return K(t)?n/K(t):0}function nt(t,n,s=null,o=!0){const r=t.spatialReference;if(r.equals(n))return t;j(r,n,s);const e=q(t,n,s);if(o&&n.isGeographic){const[i,a]=B(r,!0),l=at(r);l&&i!=null&&a!=null&&(Math.abs(t.x-i)<l&&Math.abs(180-e.x)<G?e.x-=360:Math.abs(t.x-a)<l&&Math.abs(180+e.x)<G&&(e.x+=360))}return e}function bt(t,n,s=null){const o=t[0].spatialReference;return o.equals(n)?t:(j(o,n,s),q(t,n,s))}function lt(t){const n=P(t[0].spatialReference);if(t.length<2||!z(n))return t[0];let{xmin:s,xmax:o,ymin:r,ymax:e}=t[0];for(let i=1;i<t.length;i++){const a=t[i];o=a.xmax+n*i,r=Math.min(r,a.ymin),e=Math.max(e,a.ymax)}return new _({xmin:s,xmax:o,ymin:r,ymax:e,spatialReference:t[0].spatialReference})}function Gt(t,n,s=null,o=!0){if(t.spatialReference.equals(n))return t;const r=$t(t),e=P(t.spatialReference,!0);return!z(e)||r===0?et(t,n,s,o):lt(t.clone().normalize().map(i=>et(i,n,s,o)))}function et(t,n,s=null,o=!0){const r=t.spatialReference;if(r.equals(n))return t;j(r,n,s);const e=q(t,n,s);let[i,a]=B(r,!0);if(e&&o&&r.isWebMercator&&n.isGeographic&&i!=null&&a!=null){if(Math.abs(t.xmin-i)<.001&&Math.abs(a-t.xmax)>1e3&&Math.abs(180-e.xmax)<G){e.xmin=-180;const f=[];f.push(new R(t.xmax,t.ymin,r)),f.push(new R(t.xmax,(t.ymin+t.ymax)/2,r)),f.push(new R(t.xmax,t.ymax,r));const c=f.map(x=>nt(x,n,s)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);e.xmax=Math.max.apply(null,c)}if(Math.abs(t.xmax-a)<.001&&Math.abs(i-t.xmin)>1e3&&Math.abs(180+e.xmin)<G){e.xmax=180;const f=[];f.push(new R(t.xmin,t.ymin,r)),f.push(new R(t.xmin,(t.ymin+t.ymax)/2,r)),f.push(new R(t.xmin,t.ymax,r));const c=f.map(x=>nt(x,n,s)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);e.xmin=Math.min.apply(null,c)}}[i,a]=B(n,!0);const l=at(n);return l&&i!=null&&a!=null&&e&&(Math.abs(e.xmin-i)<l&&(e.xmin=i),Math.abs(e.xmax-a)<l&&(e.xmax=a)),e}function P(t,n=!1){const s=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*s:t.wkid&&t.isGeographic?360:2*Ct[t.wkid]||null}function B(t,n=!1){const s=[],o=P(t,n);return z(o)&&(s.push(-o/2),s.push(o/2)),s}function ot(t,n,s,o){let r=(t-n)/s;return r-Math.floor(r)!=0?r=Math.floor(r):o&&(r-=1),r}function $t(t,n=!1){const s=P(t.spatialReference);if(!z(s))return 0;const o=n?0:-(s/2);return ot(t.xmax,o,s,!0)-ot(t.xmin,o,s,!1)}function kt(t){const n=t.storageInfo.origin.x,s=P(t.spatialReference,!0);if(!z(s))return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const o=s/2,{nativePixelSize:r,storageInfo:e,extent:i}=t,{maximumPyramidLevel:a,blockWidth:l,pyramidScalingFactor:m}=e;let p=r.x;const f=[],c=z(t.transform)&&t.transform.type==="gcs-shift",x=n+(c?0:o),d=c?s-n:o-n;for(let v=0;v<=a;v++){const y=(i.xmax-n)/p/l,M=y-Math.floor(y)==0?y:Math.ceil(y),w=d/p/l,u=w-Math.floor(w)==0?w:Math.ceil(w),b=Math.floor(x/p/l),g=Math.round(x/p)%l,W=(l-Math.round(d/p)%l)%l;f.push({resolutionX:p,blockWidth:l,datsetColumnCount:M,worldColumnCountFromOrigin:u,leftMargin:g,rightPadding:W,originColumnOffset:b}),p*=m}return{originX:n,halfWorldWidth:o,pyramidsInfo:f,hasGCSSShiftTransform:c}}function Lt(t){const n=t.isAdaptive&&t.spacing==null,s=t.spacing||[k,k];let o=rt(t),r={cols:o.size[0]+1,rows:o.size[1]+1},e=tt(o.offsets,r,s);const i=(e[0]+e[1])/2,a=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;return n&&(a||i>Rt)&&(o=rt(U(Q({},t),{spacing:[A,A]})),r={cols:o.size[0]+1,rows:o.size[1]+1},e=tt(o.offsets,r,s)),o.error=e,o.coefficients=St(o.offsets,r,a),o}function rt(t){const{projectedExtent:n,srcBufferExtent:s,pixelSize:o,datumTransformation:r,rasterTransform:e}=t,i=n.spatialReference,a=s.spatialReference;j(i,a);const{xmin:l,ymin:m,xmax:p,ymax:f}=n,c=P(a),x=t.hasWrapAround||(e==null?void 0:e.type)==="gcs-shift",d=t.spacing||[k,k],v={x:d[0]*o.x,y:d[1]*o.y},y={cols:Math.ceil((p-l)/v.x-.1/d[0])+1,rows:Math.ceil((f-m)/v.y-.1/d[1])+1},M=v.x,w=v.y,u=[];let b,g=0;const W=[];for(let S=0;S<y.cols;S++)for(let N=0;N<y.rows;N++)W.push(new R({x:l+M*S,y:f-w*N,spatialReference:i}));const ct=bt(W,a,r);for(let S=0;S<y.cols;S++){const N=[];for(let X=0;X<y.rows;X++){let $=ct[S*y.rows+X];e&&($=e.inverseTransform($)),N.push($),S>0&&x&&$&&b[X]&&z(c)&&$.x<b[X].x&&($.x+=c),$?(u.push(($.x-s.xmin)/(s.xmax-s.xmin)),u.push((s.ymax-$.y)/(s.ymax-s.ymin))):(u.push(NaN),u.push(NaN),g++)}b=N}return{offsets:u,error:null,coefficients:null,outofBoundPointCount:g,spacing:d,size:[y.cols-1,y.rows-1]}}function St(t,n,s){const{cols:o,rows:r}=n,e=new Float32Array((o-1)*(r-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<o-1;l++){for(let m=0;m<r-1;m++){let p=l*r*2+2*m;const f=t[p],c=t[p+1],x=t[p+2],d=t[p+3];p+=2*r;const v=t[p],y=t[p+1],M=t[p+2],w=t[p+3];let u=0,b=12*(m*(o-1)+l);for(let g=0;g<3;g++)e[b++]=i[u++]*f+i[u++]*x+i[u++]*M;u=0;for(let g=0;g<3;g++)e[b++]=i[u++]*c+i[u++]*d+i[u++]*w;u=0;for(let g=0;g<3;g++)e[b++]=a[u++]*f+a[u++]*v+a[u++]*M;u=0;for(let g=0;g<3;g++)e[b++]=a[u++]*c+a[u++]*y+a[u++]*w}if(s)for(let m=0;m<e.length;m++)isNaN(e[m])&&(e[m]=-1)}return e}function qt(t){const n=t.clone().normalize();return n.length===1?n[0]:lt(n)}function At(t,n,s){const{storageInfo:o,pixelSize:r}=n;let e,i=!1;const{pyramidResolutions:a}=o;if(z(a)&&a.length){const c=(t.x+t.y)/2,x=a[a.length-1],d=(x.x+x.y)/2,v=(r.x+r.y)/2;if(c<=v)e=0;else if(c>=d)e=a.length,i=c/d>8;else{let M,w=v;for(let u=1;u<=a.length;u++){if(M=(a[u-1].x+a[u-1].y)/2,c<=M){c===M?e=u:s==="down"?(e=u-1,i=c/w>8):e=s==="up"||c-w>M-c||c/w>2?u:u-1;break}w=M}}const y=e===0?r:a[e-1];return{pyramidLevel:e,pyramidResolution:new R({x:y.x,y:y.y,spatialReference:n.spatialReference}),excessiveReading:i}}const l=Math.log(t.x/r.x)/Math.LN2,m=Math.log(t.y/r.y)/Math.LN2,p=n.storageInfo.maximumPyramidLevel||0;e=s==="down"?Math.floor(Math.min(l,m)):s==="up"?Math.ceil(Math.max(l,m)):Math.round((l+m)/2),e<0?e=0:e>p&&(i=e>p+3,e=p);const f=2**e;return{pyramidLevel:e,pyramidResolution:new R({x:f*n.nativePixelSize.x,y:f*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:i}}let I=class extends gt{get affectsPixelSize(){return!1}forwardTransform(t){return t}inverseTransform(t){return t}};h([T()],I.prototype,"affectsPixelSize",null),h([T({json:{write:!0}})],I.prototype,"spatialReference",void 0),I=h([L("esri.layers.support.rasterTransforms.BaseRasterTransform")],I);const D=I;let O=class extends D{constructor(){super(...arguments),this.type="gcs-shift",this.tolerance=1e-8}forwardTransform(t){return(t=t.clone()).type==="point"?(t.x>180+this.tolerance&&(t.x-=360),t):(t.xmin>=180-this.tolerance?(t.xmax-=360,t.xmin-=360):t.xmax>180+this.tolerance&&(t.xmin=-180,t.xmax=180),t)}inverseTransform(t){return(t=t.clone()).type==="point"?(t.x<-this.tolerance&&(t.x+=360),t):(t.xmin<-this.tolerance&&(t.xmin+=360,t.xmax+=360),t)}};h([E({GCSShiftXform:"gcs-shift"})],O.prototype,"type",void 0),h([T()],O.prototype,"tolerance",void 0),O=h([L("esri.layers.support.rasterTransforms.GCSShiftTransform")],O);const zt=O;let F=class extends D{constructor(){super(...arguments),this.type="identity"}};h([E({IdentityXform:"identity"})],F.prototype,"type",void 0),F=h([L("esri.layers.support.rasterTransforms.IdentityTransform")],F);const Tt=F;function Y(t,n,s){const{x:o,y:r}=n;if(s<2)return{x:t[0]+o*t[2]+r*t[4],y:t[1]+o*t[3]+r*t[5]};if(s===2){const c=o*o,x=r*r,d=o*r;return{x:t[0]+o*t[2]+r*t[4]+c*t[6]+d*t[8]+x*t[10],y:t[1]+o*t[3]+r*t[5]+c*t[7]+d*t[9]+x*t[11]}}const e=o*o,i=r*r,a=o*r,l=e*o,m=e*r,p=o*i,f=r*i;return{x:t[0]+o*t[2]+r*t[4]+e*t[6]+a*t[8]+i*t[10]+l*t[12]+m*t[14]+p*t[16]+f*t[18],y:t[1]+o*t[3]+r*t[5]+e*t[7]+a*t[9]+i*t[11]+l*t[13]+m*t[15]+p*t[17]+f*t[19]}}function st(t,n,s){const{xmin:o,ymin:r,xmax:e,ymax:i,spatialReference:a}=n;let l=[];if(s<2)l.push({x:o,y:i}),l.push({x:e,y:i}),l.push({x:o,y:r}),l.push({x:e,y:r});else{let f=10;for(let c=0;c<f;c++)l.push({x:o,y:r+(i-r)*c/(f-1)}),l.push({x:e,y:r+(i-r)*c/(f-1)});f=8;for(let c=1;c<=f;c++)l.push({x:o+(e-o)*c/f,y:r}),l.push({x:o+(e-o)*c/f,y:i})}l=l.map(f=>Y(t,f,s));const m=l.map(f=>f.x),p=l.map(f=>f.y);return new _({xmin:Math.min.apply(null,m),xmax:Math.max.apply(null,m),ymin:Math.min.apply(null,p),ymax:Math.max.apply(null,p),spatialReference:a})}function Nt(t){const[n,s,o,r,e,i]=t,a=o*i-e*r,l=e*r-o*i;return[(e*s-n*i)/a,(o*s-n*r)/l,i/a,r/l,-e/a,-o/l]}let C=class extends D{constructor(){super(...arguments),this.polynomialOrder=1,this.type="polynomial"}readForwardCoefficients(t,n){const{coeffX:s,coeffY:o}=n;if(s==null||!s.length||o==null||!o.length||s.length!==o.length)return null;const r=[];for(let e=0;e<s.length;e++)r.push(s[e]),r.push(o[e]);return r}writeForwardCoefficients(t,n,s){const o=[],r=[];for(let e=0;e<(t==null?void 0:t.length);e++)e%2==0?o.push(t[e]):r.push(t[e]);n.coeffX=o,n.coeffY=r}get inverseCoefficients(){let t=this._get("inverseCoefficients");const n=this._get("forwardCoefficients");return!t&&n&&this.polynomialOrder<2&&(t=Nt(n)),t}set inverseCoefficients(t){this._set("inverseCoefficients",t)}readInverseCoefficients(t,n){const{inverseCoeffX:s,inverseCoeffY:o}=n;if(s==null||!s.length||o==null||!o.length||s.length!==o.length)return null;const r=[];for(let e=0;e<s.length;e++)r.push(s[e]),r.push(o[e]);return r}writeInverseCoefficients(t,n,s){const o=[],r=[];for(let e=0;e<(t==null?void 0:t.length);e++)e%2==0?o.push(t[e]):r.push(t[e]);n.inverseCoeffX=o,n.inverseCoeffY=r}get affectsPixelSize(){return this.polynomialOrder>0}forwardTransform(t){if(t.type==="point"){const n=Y(this.forwardCoefficients,t,this.polynomialOrder);return new R({x:n.x,y:n.y,spatialReference:t.spatialReference})}return st(this.forwardCoefficients,t,this.polynomialOrder)}inverseTransform(t){if(t.type==="point"){const n=Y(this.inverseCoefficients,t,this.polynomialOrder);return new R({x:n.x,y:n.y,spatialReference:t.spatialReference})}return st(this.inverseCoefficients,t,this.polynomialOrder)}};h([T({json:{write:!0}})],C.prototype,"polynomialOrder",void 0),h([T()],C.prototype,"forwardCoefficients",void 0),h([V("forwardCoefficients",["coeffX","coeffY"])],C.prototype,"readForwardCoefficients",null),h([Z("forwardCoefficients")],C.prototype,"writeForwardCoefficients",null),h([T({json:{write:!0}})],C.prototype,"inverseCoefficients",null),h([V("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],C.prototype,"readInverseCoefficients",null),h([Z("inverseCoefficients")],C.prototype,"writeInverseCoefficients",null),h([T()],C.prototype,"affectsPixelSize",null),h([E({PolynomialXform:"polynomial"})],C.prototype,"type",void 0),C=h([L("esri.layers.support.rasterTransforms.PolynomialTransform")],C);const Pt=C,ft={GCSShiftXform:zt,IdentityXform:Tt,PolynomialXform:Pt},Xt=Object.keys(ft);function Bt(t){const n=t==null?void 0:t.type;return!t||Xt.includes(n)}function Yt(t){if(!(t!=null&&t.type))return null;const n=ft[t==null?void 0:t.type];if(n){const s=new n;return s.read(t),s}return null}export{At as A,$t as G,Lt as L,P,Ft as R,kt as T,zt as c,Wt as d,Bt as e,Yt as f,Gt as j,Pt as m,qt as q,nt as v,Mt as x};
