import{R as se,U as G,D as P,E as x,au as ce,L as le,av as ue,aw as ie}from"./vendor.b8b0b9ef.js";import{s as F,t as M}from"./OptimizedGeometry.11fe4dff.js";import{e as fe}from"./OptimizedFeatureSet.2633cdc7.js";function m(e,n){return e?n?4:3:n?3:2}const k=se.getLogger("esri.tasks.support.optimizedFeatureSet"),B={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},H=(e,n,t,o,s,r)=>{e[t]=s,e[t+1]=r},v=(e,n,t,o,s,r)=>{e[t]=s,e[t+1]=r,e[t+2]=n[o+2]},ae=(e,n,t,o,s,r)=>{e[t]=s,e[t+1]=r,e[t+2]=n[o+3]},J=(e,n,t,o,s,r)=>{e[t]=s,e[t+1]=r,e[t+2]=n[o+2],e[t+3]=n[o+3]};function R(e,n,t,o){if(e){if(t)return n&&o?J:v;if(n&&o)return ae}else if(n&&o)return v;return H}function E({scale:e,translate:n},t){return Math.round((t-n[0])/e[0])}function L({scale:e,translate:n},t){return Math.round((n[1]-t)/e[1])}function A({scale:e,translate:n},t){return t*e[0]+n[0]}function O({scale:e,translate:n},t){return n[1]-t*e[1]}function ve(e,n,t){return e?n?t?Y(e):S(e):t?U(e):z(e):null}function z(e){const n=e.coords;return{x:n[0],y:n[1]}}function K(e,n){return e.coords[0]=n.x,e.coords[1]=n.y,e}function S(e){const n=e.coords;return{x:n[0],y:n[1],z:n[2]}}function he(e,n){return e.coords[0]=n.x,e.coords[1]=n.y,e.coords[2]=n.z,e}function U(e){const n=e.coords;return{x:n[0],y:n[1],m:n[2]}}function ge(e,n){return e.coords[0]=n.x,e.coords[1]=n.y,e.coords[2]=n.m,e}function Y(e){const n=e.coords;return{x:n[0],y:n[1],z:n[2],m:n[3]}}function de(e,n){return e.coords[0]=n.x,e.coords[1]=n.y,e.coords[2]=n.z,e.coords[3]=n.m,e}function me(e,n,t,o){let s=z;t&&o?s=Y:t?s=S:o&&(s=U);for(const r of n){const{geometry:c,attributes:u}=r,i=x(c)?s(c):null;e.push({attributes:u,geometry:i})}return e}function Q(e,n){return e&&n?de:e?he:n?ge:K}function ye(e,n,t,o,s){const r=Q(t,o);for(const c of n){const{geometry:u,attributes:i}=c;let l;u&&(l=r(new M,u)),e.push(new F(l,i,null,i[s]))}return e}function pe(e,n,t,o){for(const s of n){const{geometry:r,attributes:c}=s;let u;r&&(u=W(r,t,o)),e.push({attributes:c,geometry:u})}return e}function W(e,n,t){if(G(e))return null;const o=m(n,t),s=[];for(let r=0;r<e.coords.length;r+=o){const c=[];for(let u=0;u<o;u++)c.push(e.coords[r+u]);s.push(c)}return n?t?{points:s,hasZ:n,hasM:t}:{points:s,hasZ:n}:t?{points:s,hasM:t}:{points:s}}function be(e,n,t,o,s){const r=m(t,o);for(const c of n){const u=c.geometry,i=c.attributes;let l;u&&(l=X(new M,u,r)),e.push(new F(l,i,null,i[s]))}return e}function X(e,n,t=m(n.hasZ,n.hasM)){e.lengths[0]=n.points.length;const o=e.coords;let s=0;for(const r of n.points)for(let c=0;c<t;c++)o[s++]=r[c];return e}function we(e,n,t,o){for(const s of n){const{geometry:r,attributes:c}=s;let u;x(r)&&(u=$(r,t,o)),e.push({attributes:c,geometry:u})}return e}function $(e,n,t){if(!e)return null;const o=m(n,t),{coords:s,lengths:r}=e,c=[];let u=0;for(const i of r){const l=[];for(let f=0;f<i;f++){const a=[];for(let h=0;h<o;h++)a.push(s[u++]);l.push(a)}c.push(l)}return n?t?{paths:c,hasZ:n,hasM:t}:{paths:c,hasZ:n}:t?{paths:c,hasM:t}:{paths:c}}function Ie(e,n,t,o,s){const r=m(t,o);for(const c of n){const u=c.geometry,i=c.attributes;let l;u&&(l=ee(new M,u,r)),e.push(new F(l,i,null,i[s]))}return e}function ee(e,n,t=m(n.hasZ,n.hasM)){const{lengths:o,coords:s}=e;let r=0;for(const c of n.paths){for(const u of c)for(let i=0;i<t;i++)s[r++]=u[i];o.push(c.length)}return e}function Me(e,n,t,o){for(const s of n){const{geometry:r,attributes:c,centroid:u}=s;let i;if(x(r)&&(i=ne(r,t,o)),u){const l=z(u);e.push({attributes:c,centroid:l,geometry:i})}else e.push({attributes:c,geometry:i})}return e}function ne(e,n,t){if(!e)return null;const o=m(n,t),{coords:s,lengths:r}=e,c=[];let u=0;for(const i of r){const l=[];for(let f=0;f<i;f++){const a=[];for(let h=0;h<o;h++)a.push(s[u++]);l.push(a)}c.push(l)}return n?t?{rings:c,hasZ:n,hasM:t}:{rings:c,hasZ:n}:t?{rings:c,hasM:t}:{rings:c}}function Ge(e,n,t,o,s){for(const r of n){const c=r.geometry,u=r.centroid,i=r.attributes;let l;c&&(l=te(new M,c,t,o)),x(u)?e.push(new F(l,i,K(new M,u),i[s])):e.push(new F(l,i,null,i[s]))}return e}function te(e,n,t=n.hasZ,o=n.hasM){return Ne(e,n.rings,t,o),e}function Ne(e,n,t,o){const s=m(t,o),{lengths:r,coords:c}=e;let u=0;r.length=c.length=0;for(const i of n){for(const l of i)for(let f=0;f<s;f++)c[u++]=l[f];r.push(i.length)}return e}const T=[],Z=[];function ze(e,n,t,o,s){T[0]=e;const[r]=re(Z,T,n,t,o,s);return T.length=Z.length=0,r}function re(e,n,t,o,s,r){if(e.length=0,!t){for(const c of n){const u=c.attributes[r];e.push(new F(null,c.attributes,null,u))}return e}switch(t){case"esriGeometryPoint":return ye(e,n,o,s,r);case"esriGeometryMultipoint":return be(e,n,o,s,r);case"esriGeometryPolyline":return Ie(e,n,o,s,r);case"esriGeometryPolygon":return Ge(e,n,o,s,r);default:k.error("convertToFeatureSet:unknown-geometry",new P(`Unable to parse unknown geometry type '${t}'`)),e.length=0}return e}function Ee(e,n,t,o){Z[0]=e,oe(T,Z,n,t,o);const s=T[0];return T.length=Z.length=0,s}function Le(e,n,t){if(G(e))return null;const o=new M;return"hasZ"in e&&n==null&&(n=e.hasZ),"hasM"in e&&t==null&&(t=e.hasM),ce(e)?Q(n!=null?n:e.z!=null,t!=null?t:e.m!=null)(o,e):le(e)?te(o,e,n,t):ue(e)?ee(o,e,m(n,t)):ie(e)?X(o,e,m(n,t)):void k.error("convertFromGeometry:unknown-geometry",new P(`Unable to parse unknown geometry type '${e}'`))}function Te(e,n,t,o){const s=e&&("coords"in e?e:e.geometry);if(G(s))return null;switch(n){case"esriGeometryPoint":{let r=z;return t&&o?r=Y:t?r=S:o&&(r=U),r(s)}case"esriGeometryMultipoint":return W(s,t,o);case"esriGeometryPolyline":return $(s,t,o);case"esriGeometryPolygon":return ne(s,t,o);default:return void k.error("convertToGeometry:unknown-geometry",new P(`Unable to parse unknown geometry type '${n}'`))}}function Fe(e,n){for(const t of n)e.push({attributes:t.attributes});return e}function oe(e,n,t,o,s){if(e.length=0,G(t))return Fe(e,n);switch(t){case"esriGeometryPoint":return me(e,n,o,s);case"esriGeometryMultipoint":return pe(e,n,o,s);case"esriGeometryPolyline":return we(e,n,o,s);case"esriGeometryPolygon":return Me(e,n,o,s);default:k.error("convertToFeatureSet:unknown-geometry",new P(`Unable to parse unknown geometry type '${t}'`))}return e}function qe(e){const{objectIdFieldName:n,spatialReference:t,transform:o,fields:s,hasM:r,hasZ:c,features:u,geometryType:i,exceededTransferLimit:l,uniqueIdField:f,queryGeometry:a,queryGeometryType:h}=e,g={features:oe([],u,i,c,r),fields:s,geometryType:i,objectIdFieldName:n,spatialReference:t,uniqueIdField:f,queryGeometry:Te(a,h,!1,!1)};return o&&(g.transform=o),l&&(g.exceededTransferLimit=l),r&&(g.hasM=r),c&&(g.hasZ=c),g}function Re(e,n){const t=new fe,{hasM:o,hasZ:s,features:r,objectIdFieldName:c,spatialReference:u,geometryType:i,exceededTransferLimit:l,transform:f,fields:a}=e;return a&&(t.fields=a),t.geometryType=i,t.objectIdFieldName=c||n,t.spatialReference=u,t.objectIdFieldName?(r&&re(t.features,r,i,s,o,t.objectIdFieldName),l&&(t.exceededTransferLimit=l),o&&(t.hasM=o),s&&(t.hasZ=s),f&&(t.transform=f),t):(k.error(new P("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),t)}function Se(e){const{transform:n,features:t,hasM:o,hasZ:s}=e;if(!n)return e;for(const r of t)x(r.geometry)&&D(r.geometry,r.geometry,o,s,n),r.centroid&&D(r.centroid,r.centroid,o,s,n);return e.transform=null,e}function Ue(e,n){const{geometryType:t,features:o,hasM:s,hasZ:r}=n;if(!e)return n;for(let c=0;c<o.length;c++){const u=o[c],i=u.weakClone();i.geometry=new M,C(i.geometry,u.geometry,s,r,t,e),u.centroid&&(i.centroid=new M,C(i.centroid,u.centroid,s,r,"esriGeometryPoint",e)),o[c]=i}return n.transform=e,n}function C(e,n,t,o,s,r,c=t,u=o){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),G(n)||!n.coords.length)return null;const i=B[s],{coords:l,lengths:f}=n,a=m(t,o),h=m(t&&c,o&&u),g=R(t,o,c,u);if(!f.length)return g(e.coords,l,0,0,E(r,l[0]),L(r,l[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=a,e;let d,w,y,I,p=0,b=0,N=b;for(const _ of f){if(_<i)continue;let j=0;b=N,y=d=E(r,l[p]),I=w=L(r,l[p+1]),g(e.coords,l,b,p,y,I),j++,p+=a,b+=h;for(let V=1;V<_;V++,p+=a)y=E(r,l[p]),I=L(r,l[p+1]),y===d&&I===w||(g(e.coords,l,b,p,y-d,I-w),b+=h,j++,d=y,w=I);j>=i&&(e.lengths.push(j),N=b)}return e.coords.length=N,e.coords.length?e:null}function Ye(e,n,t,o,s,r,c=t,u=o){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!n||!n.coords.length)return null;const i=B[s],{coords:l,lengths:f}=n,a=m(t,o),h=m(t&&c,o&&u),g=R(t,o,c,u);if(!f.length)return g(e.coords,l,0,0,l[0],l[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=a,e;let d=0;const w=r*r;for(const y of f){if(y<i){d+=y*a;continue}const I=e.coords.length/h,p=d,b=d+(y-1)*a;g(e.coords,l,e.coords.length,p,l[p],l[p+1]),q(e.coords,l,a,w,g,p,b),g(e.coords,l,e.coords.length,b,l[b],l[b+1]);const N=e.coords.length/h-I;N>=i?e.lengths.push(N):e.coords.length=I*h,d+=y*a}return e.coords.length?e:null}function Ze(e,n,t,o){const s=e[n],r=e[n+1],c=e[t],u=e[t+1],i=e[o],l=e[o+1];let f=c,a=u,h=i-f,g=l-a;if(h!==0||g!==0){const d=((s-f)*h+(r-a)*g)/(h*h+g*g);d>1?(f=i,a=l):d>0&&(f+=h*d,a+=g*d)}return h=s-f,g=r-a,h*h+g*g}function q(e,n,t,o,s,r,c){let u,i=o,l=0;for(let f=r+t;f<c;f+=t)u=Ze(n,f,r,c),u>i&&(l=f,i=u);i>o&&(l-r>t&&q(e,n,t,o,s,r,l),s(e,n,e.length,l,n[l],n[l+1]),c-l>t&&q(e,n,t,o,s,l,c))}function _e(e,n,t,o){if(G(n)||!n.coords||!n.coords.length)return null;const s=m(t,o);let r=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;if(n&&n.coords){const l=n.coords;for(let f=0;f<l.length;f+=s){const a=l[f],h=l[f+1];r=Math.min(r,a),u=Math.max(u,a),c=Math.min(c,h),i=Math.max(i,h)}}return e[0]=r,e[1]=c,e[2]=u,e[3]=i,e}function D(e,n,t,o,s){const{coords:r,lengths:c}=n,u=t?o?J:v:o?v:H,i=m(t,o);if(!r.length)return e!==n&&(e.lengths.length=0,e.coords.length=0),e;if(!c.length)return u(e.coords,r,0,0,A(s,r[0]),O(s,r[1])),e!==n&&(e.lengths.length=0,e.coords.length=i),e;const[l,f]=s.scale;let a=0;for(let h=0;h<c.length;h++){const g=c[h];e.lengths[h]=g;let d=A(s,r[a]),w=O(s,r[a+1]);u(e.coords,r,a,a,d,w),a+=i;for(let y=1;y<g;y++,a+=i)d+=r[a]*l,w-=r[a+1]*f,u(e.coords,r,a,a,d,w)}return e!==n&&(e.lengths.length=c.length,e.coords.length=r.length),e}function Ve(e,n,t,o,s,r){const c=m(t,o),u=R(t,o,s,r),i=n.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...n.lengths);for(let l=0;l<i.length;l+=c)u(e.coords,i,e.coords.length,l,i[l],i[l+1]);return e}function Pe(e,n,t,o){let s=0,r=e[o*n],c=e[o*(n+1)];for(let u=1;u<t;u++){const i=r+e[o*(n+u)],l=c+e[o*(n+u)+1],f=(i-r)*(l+c);r=i,c=l,s+=f}return .5*s}function Ae(e,n){const{coords:t,lengths:o}=e;let s=0,r=0;for(let c=0;c<o.length;c++)r+=Pe(t,s,o[c],n),s+=c;return Math.abs(r)}function Oe(e,n){if(G(e))return null;const t=e.clone(),o=e.coords,s=e.lengths;let r=0;for(let c=0;c<s.length;c++){const u=s[c];let i=o[n*r],l=o[n*r+1];for(let f=1;f<u;f++){const a=i+o[n*(r+f)],h=l+o[n*(r+f)+1];t.coords[n*(r+f)]=a,t.coords[n*(r+f)+1]=h,i=a,l=h}r+=u}return t}export{ne as C,te as D,ve as G,L as M,ze as Q,$ as U,re as W,W as _,E as a,Ae as b,Re as c,Le as e,Ye as f,_e as g,C as i,Se as l,D as m,Te as n,qe as s,Ee as t,Ue as u,Oe as w,Ve as y};
