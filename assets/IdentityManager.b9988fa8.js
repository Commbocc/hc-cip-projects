var fr=Object.defineProperty,pr=Object.defineProperties;var gr=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var vr=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable;var et=(e,t,r)=>t in e?fr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))vr.call(t,r)&&et(e,r,t[r]);if(Ze)for(var r of Ze(t))mr.call(t,r)&&et(e,r,t[r]);return e},tt=(e,t)=>pr(e,gr(t));import{R as At,az as rt,aA as Le,aB as yr,aC as It,aD as _r,aE as Me,aF as br,a2 as wr,aG as Sr,aH as Ar,C as Ir,aI as kr,aJ as Tr,aK as xr,aL as st,aM as it,aN as Cr,aO as Ur,aP as Or,_ as m,$ as y,aQ as Er,a0 as te,aR as Pr,ap as kt,aS as O,aT as Tt,aU as J,O as nt,aV as he,aW as ne,D as E,aX as Rr,aY as V,N as M,aZ as ot,a_ as Ue,T as Oe,a$ as Nr,b0 as $r,b1 as fe,b2 as Dr,b3 as Lr}from"./vendor.b8b0b9ef.js";import{t as Fr}from"./uuid.e03e9d3d.js";function jr(e){return typeof e=="string"?document.getElementById(e):e}/*!
 * @esri/arcgis-html-sanitizer - v2.9.0 - Mon Dec 13 2021 15:07:01 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var qr="[object Object]";function Br(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function Hr(e,t){return function(r){return e(t(r))}}var zr=Function.prototype,xt=Object.prototype,Ct=zr.toString,Vr=xt.hasOwnProperty,Mr=Ct.call(Object),Wr=xt.toString,Gr=Hr(Object.getPrototypeOf,Object);function Xr(e){return!!e&&typeof e=="object"}function Jr(e){if(!Xr(e)||Wr.call(e)!=qr||Br(e))return!1;var t=Gr(e);if(t===null)return!0;var r=Vr.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Ct.call(r)==Mr}var Qr=Jr,Z={exports:{}},U={},ue={exports:{}},K={};function Ut(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function Kr(e,t,r){}function Yr(e,t,r){}var Zr=/javascript\s*\:/img;function es(e,t){return Zr.test(t)?"":t}K.whiteList=Ut();K.getDefaultWhiteList=Ut;K.onAttr=Kr;K.onIgnoreAttr=Yr;K.safeAttrValue=es;var ts={indexOf:function(e,t){var r,s;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,s=e.length;r<s;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var s,i;if(Array.prototype.forEach)return e.forEach(t,r);for(s=0,i=e.length;s<i;s++)t.call(r,e[s],s,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},oe=ts;function rs(e,t){e=oe.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,s=!1,i=0,n=0,a="";function o(){if(!s){var u=oe.trim(e.slice(i,n)),h=u.indexOf(":");if(h!==-1){var d=oe.trim(u.slice(0,h)),f=oe.trim(u.slice(h+1));if(d){var b=t(i,a.length,d,f,u);b&&(a+=b+"; ")}}}i=n+1}for(;n<r;n++){var c=e[n];if(c==="/"&&e[n+1]==="*"){var l=e.indexOf("*/",n+2);if(l===-1)break;n=l+1,i=n+1,s=!1}else c==="("?s=!0:c===")"?s=!1:c===";"?s||o():c===`
`&&o()}return oe.trim(a)}var ss=rs,pe=K,is=ss;function at(e){return e==null}function ns(e){var t={};for(var r in e)t[r]=e[r];return t}function Ot(e){e=ns(e||{}),e.whiteList=e.whiteList||pe.whiteList,e.onAttr=e.onAttr||pe.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||pe.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||pe.safeAttrValue,this.options=e}Ot.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,s=r.whiteList,i=r.onAttr,n=r.onIgnoreAttr,a=r.safeAttrValue,o=is(e,function(c,l,u,h,d){var f=s[u],b=!1;if(f===!0?b=f:typeof f=="function"?b=f(h):f instanceof RegExp&&(b=f.test(h)),b!==!0&&(b=!1),h=a(u,h),!!h){var v={position:l,sourcePosition:c,source:d,isWhite:b};if(b){var w=i(u,h,v);return at(w)?u+":"+h:w}else{var w=n(u,h,v);if(!at(w))return w}}});return o};var os=Ot;(function(e,t){var r=K,s=os;function i(a,o){var c=new s(o);return c.process(a)}t=e.exports=i,t.FilterCSS=s;for(var n in r)t[n]=r[n]})(ue,ue.exports);var We={indexOf:function(e,t){var r,s;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,s=e.length;r<s;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var s,i;if(Array.prototype.forEach)return e.forEach(t,r);for(s=0,i=e.length;s<i;s++)t.call(r,e[s],s,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},as=ue.exports.FilterCSS,ls=ue.exports.getDefaultWhiteList,Ie=We;function Et(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Pt=new as;function cs(e,t,r){}function us(e,t,r){}function ds(e,t,r){}function hs(e,t,r){}function Rt(e){return e.replace(ps,"&lt;").replace(gs,"&gt;")}function fs(e,t,r,s){if(r=jt(r),t==="href"||t==="src"){if(r=Ie.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(ge.lastIndex=0,ge.test(r))return""}else if(t==="style"){if(lt.lastIndex=0,lt.test(r)||(ct.lastIndex=0,ct.test(r)&&(ge.lastIndex=0,ge.test(r))))return"";s!==!1&&(s=s||Pt,r=s.process(r))}return r=qt(r),r}var ps=/</g,gs=/>/g,vs=/"/g,ms=/&quot;/g,ys=/&#([a-zA-Z0-9]*);?/gim,_s=/&colon;?/gim,bs=/&newline;?/gim,ge=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,lt=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ct=/u\s*r\s*l\s*\(.*/gi;function Nt(e){return e.replace(vs,"&quot;")}function $t(e){return e.replace(ms,'"')}function Dt(e){return e.replace(ys,function(r,s){return s[0]==="x"||s[0]==="X"?String.fromCharCode(parseInt(s.substr(1),16)):String.fromCharCode(parseInt(s,10))})}function Lt(e){return e.replace(_s,":").replace(bs," ")}function Ft(e){for(var t="",r=0,s=e.length;r<s;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return Ie.trim(t)}function jt(e){return e=$t(e),e=Dt(e),e=Lt(e),e=Ft(e),e}function qt(e){return e=Nt(e),e=Rt(e),e}function ws(){return""}function Ss(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function s(a){return r?!0:Ie.indexOf(e,a)!==-1}var i=[],n=!1;return{onIgnoreTag:function(a,o,c){if(s(a))if(c.isClosing){var l="[/removed]",u=c.position+l.length;return i.push([n!==!1?n:c.position,u]),n=!1,l}else return n||(n=c.position),"[removed]";else return t(a,o,c)},remove:function(a){var o="",c=0;return Ie.forEach(i,function(l){o+=a.slice(c,l[0]),c=l[1]}),o+=a.slice(c),o}}}function As(e){for(var t="",r=0;r<e.length;){var s=e.indexOf("<!--",r);if(s===-1){t+=e.slice(r);break}t+=e.slice(r,s);var i=e.indexOf("-->",s);if(i===-1)break;r=i+3}return t}function Is(e){var t=e.split("");return t=t.filter(function(r){var s=r.charCodeAt(0);return s===127?!1:s<=31?s===10||s===13:!0}),t.join("")}U.whiteList=Et();U.getDefaultWhiteList=Et;U.onTag=cs;U.onIgnoreTag=us;U.onTagAttr=ds;U.onIgnoreTagAttr=hs;U.safeAttrValue=fs;U.escapeHtml=Rt;U.escapeQuote=Nt;U.unescapeQuote=$t;U.escapeHtmlEntities=Dt;U.escapeDangerHtml5Entities=Lt;U.clearNonPrintableCharacter=Ft;U.friendlyAttrValue=jt;U.escapeAttrValue=qt;U.onIgnoreTagStripAll=ws;U.StripTagBody=Ss;U.stripCommentTag=As;U.stripBlankChar=Is;U.cssFilter=Pt;U.getDefaultCSSWhiteList=ls;var xe={},G=We;function ks(e){var t=G.spaceIndex(e);if(t===-1)var r=e.slice(1,-1);else var r=e.slice(1,t+1);return r=G.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Ts(e){return e.slice(0,2)==="</"}function xs(e,t,r){var s="",i=0,n=!1,a=!1,o=0,c=e.length,l="",u="";e:for(o=0;o<c;o++){var h=e.charAt(o);if(n===!1){if(h==="<"){n=o;continue}}else if(a===!1){if(h==="<"){s+=r(e.slice(i,o)),n=o,i=o;continue}if(h===">"){s+=r(e.slice(i,n)),u=e.slice(n,o+1),l=ks(u),s+=t(n,s.length,l,u,Ts(u)),i=o+1,n=!1;continue}if(h==='"'||h==="'")for(var d=1,f=e.charAt(o-d);f.trim()===""||f==="=";){if(f==="="){a=h;continue e}f=e.charAt(o-++d)}}else if(h===a){a=!1;continue}}return i<e.length&&(s+=r(e.substr(i))),s}var Cs=/[^a-zA-Z0-9_:\.\-]/gim;function Us(e,t){var r=0,s=[],i=!1,n=e.length;function a(h,d){if(h=G.trim(h),h=h.replace(Cs,"").toLowerCase(),!(h.length<1)){var f=t(h,d||"");f&&s.push(f)}}for(var o=0;o<n;o++){var c=e.charAt(o),l,u;if(i===!1&&c==="="){i=e.slice(r,o),r=o+1;continue}if(i!==!1&&o===r&&(c==='"'||c==="'")&&e.charAt(o-1)==="="){if(u=e.indexOf(c,o+1),u===-1)break;l=G.trim(e.slice(r+1,u)),a(i,l),i=!1,o=u,r=o+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),i===!1)if(u=Os(e,o),u===-1){l=G.trim(e.slice(r,o)),a(l),i=!1,r=o+1;continue}else{o=u-1;continue}else if(u=Es(e,o-1),u===-1){l=G.trim(e.slice(r,o)),l=ut(l),a(i,l),i=!1,r=o+1;continue}else continue}return r<e.length&&(i===!1?a(e.slice(r)):a(i,ut(G.trim(e.slice(r))))),G.trim(s.join(" "))}function Os(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function Es(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function Ps(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function ut(e){return Ps(e)?e.substr(1,e.length-2):e}xe.parseTag=xs;xe.parseAttr=Us;var Rs=ue.exports.FilterCSS,j=U,Bt=xe,Ns=Bt.parseTag,$s=Bt.parseAttr,be=We;function ve(e){return e==null}function Ds(e){var t=be.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=be.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=be.trim(e.slice(0,-1))),{html:e,closing:r}}function Ls(e){var t={};for(var r in e)t[r]=e[r];return t}function Ht(e){e=Ls(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=j.onIgnoreTagStripAll),e.whiteList=e.whiteList||j.whiteList,e.onTag=e.onTag||j.onTag,e.onTagAttr=e.onTagAttr||j.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||j.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||j.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||j.safeAttrValue,e.escapeHtml=e.escapeHtml||j.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new Rs(e.css))}Ht.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,s=r.whiteList,i=r.onTag,n=r.onIgnoreTag,a=r.onTagAttr,o=r.onIgnoreTagAttr,c=r.safeAttrValue,l=r.escapeHtml,u=t.cssFilter;r.stripBlankChar&&(e=j.stripBlankChar(e)),r.allowCommentTag||(e=j.stripCommentTag(e));var h=!1;if(r.stripIgnoreTagBody){var h=j.StripTagBody(r.stripIgnoreTagBody,n);n=h.onIgnoreTag}var d=Ns(e,function(f,b,v,w,A){var I={sourcePosition:f,position:b,isClosing:A,isWhite:s.hasOwnProperty(v)},$=i(v,w,I);if(!ve($))return $;if(I.isWhite){if(I.isClosing)return"</"+v+">";var B=Ds(w),_=s[v],p=$s(B.html,function(S,k){var T=be.indexOf(_,S)!==-1,x=a(v,S,k,T);if(!ve(x))return x;if(T)return k=c(v,S,k,u),k?S+'="'+k+'"':S;var x=o(v,S,k,T);return ve(x)?void 0:x}),w="<"+v;return p&&(w+=" "+p),B.closing&&(w+=" /"),w+=">",w}else{var $=n(v,w,I);return ve($)?l(w):$}},l);return h&&(d=h.remove(d)),d};var Fs=Ht;(function(e,t){var r=U,s=xe,i=Fs;function n(c,l){var u=new i(l);return u.process(c)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=i;for(var a in r)t[a]=r[a];for(var a in s)t[a]=s[a];function o(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(Z,Z.exports);var js=function(){function e(t,r){var s=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,a,o,c){return n==="a"&&a==="href"||(n==="img"||n==="source")&&a==="src"?s.sanitizeUrl(o):Z.exports.safeAttrValue(n,a,o,c)}};var i;t&&!r?i=t:t&&r?(i=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?i.whiteList=s._extendObjectOfArrays([s.arcgisWhiteList,t.whiteList||{}]):i[n]=t[n]})):(i=Object.create(this.arcgisFilterOptions),i.whiteList=this.arcgisWhiteList),this.xssFilterOptions=i,this._xssFilter=new Z.exports.FilterXSS(i)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t){var r=this._trim(t.substring(0,t.indexOf(":")));return t==="/"||t==="#"||t[0]==="#"||this.allowedProtocols.indexOf(r.toLowerCase())>-1?Z.exports.escapeAttrValue(t):""},e.prototype.sanitizeHTMLAttribute=function(t,r,s,i){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,s,i):Z.exports.safeAttrValue(t,r,s,i)},e.prototype.validate=function(t,r){r===void 0&&(r={});var s=this.sanitize(t,r);return{isValid:t===s,sanitized:s}},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(s){Object.keys(s).forEach(function(i){Array.isArray(s[i])&&Array.isArray(r[i])?r[i]=r[i].concat(s[i]):r[i]=s[i]})}),r},e.prototype._iterateOverObject=function(t,r){var s=this;r===void 0&&(r={});try{var i=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(o,c){var l=s.validate(c,r);return l.isValid?o.concat([c]):(i=!0,o.concat([l.sanitized]))},[]);else if(Qr(t)){var a=Object.keys(t);n=a.reduce(function(o,c){var l=t[c],u=s.validate(l,r);return u.isValid?o[c]=l:(i=!0,o[c]=u.sanitized),o},{})}else return r.allowUndefined&&typeof t=="undefined"?void 0:null;return i?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();function qs(e){const t=rt.acquire();for(let s=0;s<arguments.length;s++){const i=arguments[s],n=typeof i;if(n==="string")t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if(n==="object")for(const a in i)i[a]&&t.push(a)}const r=t.join(" ");return rt.release(t),r}function dt(e){const t="data-node-ref";this[e.getAttribute(t)]=e}At.getLogger("esri.widgets.support.widgetUtils");const Bs=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],Hs=Bs.reduce((e,t)=>(e[t]=[],e),{}),zs=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],zt=new js({whiteList:Hs,onTagAttr:(e,t,r)=>{const s=`${t}="${r}"`;if(zs.includes(t))return s},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Vs(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}const Vt="http://www.w3.org/",Ce=`${Vt}2000/svg`,Mt=`${Vt}1999/xlink`;let ke,ht=[],Ge=(e,t)=>{let r={};return Object.keys(e).forEach(s=>{r[s]=e[s]}),t&&Object.keys(t).forEach(s=>{r[s]=t[s]}),r},Xe=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Wt=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},Ms=(e,t,r)=>{if(t.vnodeSelector!==""){for(let s=r;s<e.length;s++)if(Xe(e[s],t))return s}return-1},Ee=(e,t,r,s)=>{let i=e[t];if(i.vnodeSelector==="")return;let n=i.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let a=0;a<e.length;a++)if(a!==t){let o=e[a];if(Xe(o,i))throw new Error(`${r.vnodeSelector} had a ${i.vnodeSelector} child ${s==="added"?s:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Ws=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},Fe=[],je=!1,Gt=e=>{(e.children||[]).forEach(Gt),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},ft=()=>{je=!1,Fe.forEach(Gt),Fe.length=0},pt=e=>{Fe.push(e),je||(je=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(ft,{timeout:16}):setTimeout(ft,16))},gt=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),pt(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),pt(e))},Gs=(e,t,r)=>{if(!t)return;let s=r.eventHandlerInterceptor,i=Object.keys(t),n=i.length;for(let a=0;a<n;a++){let o=i[a],c=t[o];if(o==="className")throw new Error('Property "className" is not supported, use "class".');if(o==="class")qe(e,c,!0);else if(o==="classes"){let l=Object.keys(c),u=l.length;for(let h=0;h<u;h++){let d=l[h];c[d]&&e.classList.add(d)}}else if(o==="styles"){let l=Object.keys(c),u=l.length;for(let h=0;h<u;h++){let d=l[h],f=c[d];f&&(Wt(f),r.styleApplyer(e,d,f))}}else if(o!=="key"&&c!=null){let l=typeof c;l==="function"?(o.lastIndexOf("on",0)===0&&(s&&(c=s(o,c,e,t)),o==="oninput"&&function(){let u=c;c=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),e[o]=c):r.namespace===Ce?o==="href"?e.setAttributeNS(Mt,o,c):e.setAttribute(o,c):l==="string"&&o!=="value"?o==="innerHTML"?e[o]=zt.sanitize(c):e.setAttribute(o,c):e[o]=c}}},Xs=(e,t,r)=>{if(t)for(let s of t)ee(s,e,void 0,r)},Xt=(e,t,r)=>{Xs(e,t.children,r),t.text&&(e.textContent=t.text),Gs(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},ee=(e,t,r,s)=>{let i,n=0,a=e.vnodeSelector,o=t.ownerDocument;if(a==="")i=e.domNode=o.createTextNode(e.text),r!==void 0?t.insertBefore(i,r):t.appendChild(i);else{for(let c=0;c<=a.length;++c){let l=a.charAt(c);if(c===a.length||l==="."||l==="#"){let u=a.charAt(n-1),h=a.slice(n,c);u==="."?i.classList.add(h):u==="#"?i.id=h:(h==="svg"&&(s=Ge(s,{namespace:Ce})),s.namespace!==void 0?i=e.domNode=o.createElementNS(s.namespace,h):(i=e.domNode=e.domNode||o.createElement(h),h==="input"&&e.properties&&e.properties.type!==void 0&&i.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(i,r):i.parentNode!==t&&t.appendChild(i)),n=c+1}}Xt(i,e,s)}},qe=(e,t,r)=>{t&&t.split(" ").forEach(s=>{s&&e.classList.toggle(s,r)})},Js=(e,t,r,s)=>{if(!r)return;let i=!1,n=Object.keys(r),a=n.length;for(let o=0;o<a;o++){let c=n[o],l=r[c],u=t[c];if(c==="class")u!==l&&(qe(e,u,!1),qe(e,l,!0));else if(c==="classes"){let h=e.classList,d=Object.keys(l),f=d.length;for(let b=0;b<f;b++){let v=d[b],w=!!l[v];w!==!!u[v]&&(i=!0,w?h.add(v):h.remove(v))}}else if(c==="styles"){let h=Object.keys(l),d=h.length;for(let f=0;f<d;f++){let b=h[f],v=l[b];v!==u[b]&&(i=!0,v?(Wt(v),s.styleApplyer(e,b,v)):s.styleApplyer(e,b,""))}}else if(l||typeof u!="string"||(l=""),c==="value"){let h=e[c];h!==l&&(e["oninput-value"]?h===e["oninput-value"]:l!==u)&&(e[c]=l,e["oninput-value"]=void 0),l!==u&&(i=!0)}else if(l!==u){let h=typeof l;h==="function"&&s.eventHandlerInterceptor||(s.namespace===Ce?c==="href"?e.setAttributeNS(Mt,c,l):e.setAttribute(c,l):h==="string"?c==="innerHTML"?e[c]=zt.sanitize(l):c==="role"&&l===""?e.removeAttribute(c):e.setAttribute(c,l):e[c]!==l&&(e[c]=l),i=!0)}}return i},Qs=(e,t,r,s,i)=>{if(r===s)return!1;s=s||ht;let n,a=(r=r||ht).length,o=s.length,c=0,l=0,u=!1;for(;l<o;){let h=c<a?r[c]:void 0,d=s[l];if(h!==void 0&&Xe(h,d))u=ke(h,d,i)||u,c++;else{let f=Ms(r,d,c+1);if(f>=0){for(n=c;n<f;n++)gt(r[n]),Ee(r,n,e,"removed");u=ke(r[f],d,i)||u,c=f+1}else ee(d,t,c<a?r[c].domNode:void 0,i),Ws(d),Ee(s,l,e,"added")}l++}if(a>c)for(n=c;n<a;n++)gt(r[n]),Ee(r,n,e,"removed");return u};ke=(e,t,r)=>{let s=e.domNode,i=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let a=s.ownerDocument.createTextNode(t.text);return s.parentNode.replaceChild(a,s),t.domNode=a,i=!0,i}t.domNode=s}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=Ge(r,{namespace:Ce})),e.text!==t.text&&(n=!0,t.text===void 0?s.removeChild(s.firstChild):s.textContent=t.text),t.domNode=s,n=Qs(t,s,e.children,t.children,r)||n,n=Js(s,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[s,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(s,t.properties,e.properties),i};let ae=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let s=e;e=r,ke(s,r,t)},domNode:e.domNode});const Ks={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let le=e=>Ge(Ks,e),me={create:(e,t)=>(t=le(t),ee(e,document.createElement("div"),void 0,t),ae(e,t)),append:(e,t,r)=>(r=le(r),ee(t,e,void 0,r),ae(t,r)),insertBefore:(e,t,r)=>(r=le(r),ee(t,e.parentNode,e,r),ae(t,r)),merge:(e,t,r)=>(r=le(r),t.domNode=e,Xt(e,t,r),ae(t,r)),replace:(e,t,r)=>(r=le(r),ee(t,e.parentNode,e,r),e.parentNode.removeChild(e),ae(t,r))};const Ys={handleInterceptedEvent:(e,t,r,s)=>(e.scheduleRender(),t.properties[`on${s.type}`].apply(t.properties.bind||r,[s]))},Zs={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},ei=e=>F(F({},Zs),e),ti=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},ri=(e,t)=>e.find(t),vt=(e,t,r=!1)=>{let s=e;return t.forEach((i,n)=>{var a;const o=(a=s)!=null&&a.children?ri(s.children,c=>c.domNode===i):void 0;r&&!o&&n!==t.length-1||(s=o)}),s},si=e=>{let t;const r=F(F({},Ys),e),s=ei(r),i=s.performanceLogger;let n,a=!0,o=!1;const c=[],l=[],u=(d,f,b)=>{let v;s.eventHandlerInterceptor=(A,I,$,B)=>function(_){let p;i("domEvent",_);const g=ti(_.currentTarget,v.domNode),S=g.some(T=>{var x;return customElements.get(T==null||(x=T.tagName)==null?void 0:x.toLowerCase())});if(_.eventPhase===Event.CAPTURING_PHASE||!S)g.reverse(),p=vt(v.getLastRender(),g);else{const T=_.composedPath(),x=T.slice(T.indexOf(_.currentTarget),T.indexOf(v.domNode)).filter(z=>z.getRootNode()===z.ownerDocument).reverse();p=vt(v.getLastRender(),x,!0)}let k;return p&&(k=r.handleInterceptedEvent(t,p,this,_)),i("domEventProcessed",_),k},r.postProcessProjectionOptions==null||r.postProcessProjectionOptions(s);const w=b();v=d(f,w,s),c.push(v),l.push(b),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(v,w)};let h=()=>{if(n=void 0,a){a=!1,i("renderStart",void 0);for(let d=0;d<c.length;d++){const f=l[d]();i("rendered",void 0),c[d].update(f),i("patched",void 0)}i("renderDone",void 0),a=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,c,l)),t={renderNow:h,scheduleRender:()=>{n||o||(n=requestAnimationFrame(h))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),o=!0},resume:()=>{o=!1,a=!0,t.scheduleRender()},append:(d,f)=>{u(me.append,d,f)},insertBefore:(d,f)=>{u(me.insertBefore,d,f)},merge:(d,f)=>{u(me.merge,d,f)},replace:(d,f)=>{u(me.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),c.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},Q={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0},Je=typeof window!="undefined"?window:{};Q.cssVarShim&&Je.CSS;const ii=Je.document||{head:{}};Je.HTMLElement||class{};Q.shadowDomShim&&Q.shadowDom&&(ii.head.attachShadow+"").indexOf("[native")>-1;Q.constructableCSS;const ni=e=>e;Q.isTesting;Q.isDev,Q.isTesting;let Jt;function oi(){ni(Le(yr(Jt)))}Jt="components/assets";const Qt=Symbol("widget"),ai=[],li={},Te=new WeakMap;function Kt(e,t){let r=t.children;if(r&&r.length)for(let i=0;i<r.length;++i)r[i]=Kt(e,r[i]);else r=ai;const s=t.vnodeSelector;if(Qe(s)){const i=t.properties||li,n=i.key||s;return{vnodeSelector:"div",properties:{key:n,afterCreate:ci,afterUpdate:ui,afterRemoved:Yt,parentWidget:e,widgetConstructor:s,widgetProperties:tt(F({},i),{key:n,children:r})},children:void 0,text:void 0,domNode:null}}return t}function ci(e,t,r,{parentWidget:s,widgetConstructor:i,widgetProperties:n}){const a=new i(n);a.container=e,Te.set(e,a),a.afterCreate==null||a.afterCreate(a,e),s._internalHandles.add(It(()=>Yt(e)))}function ui(e,t,r,{widgetProperties:s}){const i=Te.get(e);i&&(i.set(s),i.afterUpdate==null||i.afterUpdate(i,e))}function Yt(e){const t=Te.get(e);t&&(t.destroy(),Te.delete(e))}function Qe(e){return typeof e=="function"&&e[Qt]}const Zt="esri.widgets.Widget",mt=At.getLogger(Zt);let di=0;const Y=new Map,hi={widgetIcon:"esri-icon-checkbox-unchecked"};function er(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?er(e[r],t[r]):e[r]=t[r]);return e}const fi=si({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(s,i,n,a)=>{const o=t(s,i,n,a),c=r.test(s);if(!((s=s.replace(r,"")).toLowerCase()in n)||c){const l=s[2].toLowerCase()+s.slice(3),u=f=>o.call(n,f);n.addEventListener(l,u,c);const h=()=>n.removeEventListener(l,u,c),d=a.afterRemoved;a.afterRemoved=f=>{d==null||d(f),h()}}return o}},handleInterceptedEvent(e,t,r,s){const{eventPhase:i,type:n}=s,a=i===Event.CAPTURING_PHASE;let o=`on${n}${a?"capture":""}`;const c=t.properties;(o in c||(o=`on${n[0].toUpperCase()}${n.slice(1)}${a?"Capture":""}`,o in c))&&(Y.clear(),e.scheduleRender(),c[o].call(c.bind||r,s))}});let Pe=!1,P=class extends _r(Me.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new br,this._projector=fi,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=hi.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=wr(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Sr(this._messageBundleProps.map(async({bundlePath:c,propertyName:l})=>{let u=await Ar(c);this.uiStrings&&Object.keys(this.uiStrings)&&(u=er(Ir(u),this.uiStrings)),this[l]=u}));for(const c of o)c.error&&mt.error("widget-intl:locale-error",this.declaredClass,c.error)}await this.loadLocale()}),oi();const r=["light","dark"],s=Vs()||"light";r.includes(s)||kr(mt,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const i="esri-widget-uid-"+Fr(),n=this.render.bind(this);this._trackingTarget=new Tr(()=>this.scheduleRender());const a=()=>{var o;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const c=n();let{properties:l}=c;l||(c.properties=l={});let{key:u,styles:h}=l;u||(l.key=i),h||(l.styles=h={}),h.display||(h.display="");let d=0;return(o=c.children)==null||o.forEach(f=>{if(Qe(f.vnodeSelector))return;let{properties:b}=f;b||(f.properties=b={}),b.key||(b.key=`${this.id}--${d++}`)}),Kt(this,c)};this.render=()=>{if(Pe)return a();let o=Y.get(this);if(o)return o;this._trackingTarget.clear(),Pe=!0;try{o=xr(this._trackingTarget,a)}finally{Pe=!1}return Y.set(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()}))}normalizeCtorArgs(e,t){const r=F({},e);return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(st)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget=it(this._trackingTarget),this.viewModel=it(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Y.delete(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return jr(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+di++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Y.delete(this),this._projector.scheduleRender())}classes(...e){return qs.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){Y.delete(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this._internalHandles.add(Cr(this,"viewModel",(r,s)=>{s&&this._internalHandles.remove("delegated-events"),r&&this._internalHandles.add(this._delegatedEventNames.map(i=>r.on(i,n=>{this.emit(i,n)})),"delegated-events")})),this.postInitialize();const t=async()=>{await this._loadLocale().catch(st),this.scheduleRender()};this._internalHandles.add([Ur(t),this.watch("uiStrings",t),Or(this,"container",async r=>{this.destroyed||this._attach(r)})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};P[Qt]=!0,m([y()],P.prototype,"_readyForTrueRender",void 0),m([y({value:null})],P.prototype,"container",null),m([Er("container")],P.prototype,"castContainer",null),m([y({aliasOf:"container"})],P.prototype,"domNode",void 0),m([y()],P.prototype,"iconClass",void 0),m([y()],P.prototype,"id",null),m([y()],P.prototype,"label",void 0),m([y()],P.prototype,"renderable",null),m([y()],P.prototype,"uiStrings",void 0),m([y()],P.prototype,"viewModel",void 0),m([y()],P.prototype,"visible",void 0),m([y()],P.prototype,"key",void 0),m([y()],P.prototype,"children",void 0),m([y()],P.prototype,"afterCreate",void 0),m([y()],P.prototype,"afterUpdate",void 0),m([y()],P.prototype,"afterRemoved",void 0),P=m([te(Zt)],P);const tr=P;function rr(e){return function(t,r){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var pi=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},sr=function(e,t){for(var r=0,s=e.length;r<s;r++){var i=e[r];Array.isArray(i)?sr(i,t):i!=null&&i!==!1&&(i.hasOwnProperty("vnodeSelector")||(i=pi(i)),t.push(i))}},gi=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var i=[];return sr(r,i),{vnodeSelector:e,properties:t||void 0,children:i,text:void 0,domNode:null}};function R(e,t,...r){return typeof e!="function"||Qe(e)?gi(e,t,...r):e(t,...r)}const D={base:"esri-identity-form",group:"esri-identity-form__group",label:"esri-identity-form__label",footer:"esri-identity-form__footer",esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},vi="ArcGIS Online";let H=class extends tr{constructor(e,t){super(e,t),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:t,resource:r,signingIn:s,oAuthPrompt:i,messages:n}=this,a=R("div",{class:D.group},Pr(i?n.oAuthInfo:n.info,{server:/\.arcgis\.com/i.test(t)?vi:t,resource:`(${r||n.lblItem})`})),o=i?null:R("div",{class:D.group,key:"username"},R("label",{class:D.label},n.lblUser,R("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:dt,"data-node-ref":"_usernameInputNode",class:D.esriInput}))),c=i?null:R("div",{class:D.group,key:"password"},R("label",{class:D.label},n.lblPwd,R("input",{value:"",required:!0,type:"password",bind:this,afterCreate:dt,"data-node-ref":"_passwordInputNode",class:D.esriInput}))),l=R("div",{class:this.classes(D.group,D.footer)},R("input",{type:"submit",disabled:!!s,value:s?n.lblSigning:n.lblOk,class:D.esriButton}),R("input",{type:"button",value:n.lblCancel,bind:this,onclick:this._cancel,class:this.classes(D.esriButton,D.esriButtonSecondary)})),u=e?R("div",null,e.details&&e.details.httpStatus?n.invalidUser:n.noAuthService):null;return R("form",{class:D.base,bind:this,onsubmit:this._submit},a,u,o,c,l)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const t=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",t)}};m([y(),rr("esri/identity/t9n/identity")],H.prototype,"messages",void 0),m([y()],H.prototype,"signingIn",void 0),m([y()],H.prototype,"server",void 0),m([y()],H.prototype,"resource",void 0),m([y()],H.prototype,"error",void 0),m([y()],H.prototype,"oAuthPrompt",void 0),H=m([te("esri.identity.IdentityForm")],H);const mi=H;function yi(e){return e&&typeof e.render=="function"}/*!
* tabbable 5.2.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var ir=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Be=ir.join(","),de=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,nr=function(t,r,s){var i=Array.prototype.slice.apply(t.querySelectorAll(Be));return r&&de.call(t,Be)&&i.unshift(t),i=i.filter(s),i},_i=function(t){return t.contentEditable==="true"},or=function(t){var r=parseInt(t.getAttribute("tabindex"),10);return isNaN(r)?_i(t)||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:r},bi=function(t,r){return t.tabIndex===r.tabIndex?t.documentOrder-r.documentOrder:t.tabIndex-r.tabIndex},Ke=function(t){return t.tagName==="INPUT"},wi=function(t){return Ke(t)&&t.type==="hidden"},Si=function(t){var r=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(s){return s.tagName==="SUMMARY"});return r},Ai=function(t,r){for(var s=0;s<t.length;s++)if(t[s].checked&&t[s].form===r)return t[s]},Ii=function(t){if(!t.name)return!0;var r=t.form||t.ownerDocument,s=function(o){return r.querySelectorAll('input[type="radio"][name="'+o+'"]')},i;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")i=s(window.CSS.escape(t.name));else try{i=s(t.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var n=Ai(i,t.form);return!n||n===t},ki=function(t){return Ke(t)&&t.type==="radio"},Ti=function(t){return ki(t)&&!Ii(t)},xi=function(t,r){if(getComputedStyle(t).visibility==="hidden")return!0;var s=de.call(t,"details>summary:first-of-type"),i=s?t.parentElement:t;if(de.call(i,"details:not([open]) *"))return!0;if(!r||r==="full")for(;t;){if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}else if(r==="non-zero-area"){var n=t.getBoundingClientRect(),a=n.width,o=n.height;return a===0&&o===0}return!1},Ci=function(t){if(Ke(t)||t.tagName==="SELECT"||t.tagName==="TEXTAREA"||t.tagName==="BUTTON")for(var r=t.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var s=0;s<r.children.length;s++){var i=r.children.item(s);if(i.tagName==="LEGEND")return!i.contains(t)}return!0}r=r.parentElement}return!1},Ye=function(t,r){return!(r.disabled||wi(r)||xi(r,t.displayCheck)||Si(r)||Ci(r))},ar=function(t,r){return!(!Ye(t,r)||Ti(r)||or(r)<0)},Ui=function(t,r){r=r||{};var s=[],i=[],n=nr(t,r.includeContainer,ar.bind(null,r));n.forEach(function(o,c){var l=or(o);l===0?s.push(o):i.push({documentOrder:c,tabIndex:l,node:o})});var a=i.sort(bi).map(function(o){return o.node}).concat(s);return a},Oi=function(t,r){r=r||{};var s=nr(t,r.includeContainer,Ye.bind(null,r));return s},ye=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return de.call(t,Be)===!1?!1:ar(r,t)},Ei=ir.concat("iframe").join(","),Re=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return de.call(t,Ei)===!1?!1:Ye(r,t)};/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function yt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Pi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yt(Object(r),!0).forEach(function(s){Ri(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Ri(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _t=function(){var e=[];return{activateTrap:function(r){if(e.length>0){var s=e[e.length-1];s!==r&&s.pause()}var i=e.indexOf(r);i===-1||e.splice(i,1),e.push(r)},deactivateTrap:function(r){var s=e.indexOf(r);s!==-1&&e.splice(s,1),e.length>0&&e[e.length-1].unpause()}}}(),Ni=function(t){return t.tagName&&t.tagName.toLowerCase()==="input"&&typeof t.select=="function"},$i=function(t){return t.key==="Escape"||t.key==="Esc"||t.keyCode===27},Di=function(t){return t.key==="Tab"||t.keyCode===9},bt=function(t){return setTimeout(t,0)},Ne=function(t,r){var s=-1;return t.every(function(i,n){return r(i)?(s=n,!1):!0}),s},ce=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];return typeof t=="function"?t.apply(void 0,s):t},_e=function(t){return t.target.shadowRoot&&typeof t.composedPath=="function"?t.composedPath()[0]:t.target},Li=function(t,r){var s=(r==null?void 0:r.document)||document,i=Pi({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},r),n={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},a,o=function(p,g,S){return p&&p[g]!==void 0?p[g]:i[S||g]},c=function(p){return!!(p&&n.containers.some(function(g){return g.contains(p)}))},l=function(p){var g=i[p];if(typeof g=="function"){for(var S=arguments.length,k=new Array(S>1?S-1:0),T=1;T<S;T++)k[T-1]=arguments[T];g=g.apply(void 0,k)}if(!g){if(g===void 0||g===!1)return g;throw new Error("`".concat(p,"` was specified but was not a node, or did not return a node"))}var x=g;if(typeof g=="string"&&(x=s.querySelector(g),!x))throw new Error("`".concat(p,"` as selector refers to no known node"));return x},u=function(){var p=l("initialFocus");if(p===!1)return!1;if(p===void 0)if(c(s.activeElement))p=s.activeElement;else{var g=n.tabbableGroups[0],S=g&&g.firstTabbableNode;p=S||l("fallbackFocus")}if(!p)throw new Error("Your focus-trap needs to have at least one focusable element");return p},h=function(){if(n.tabbableGroups=n.containers.map(function(p){var g=Ui(p),S=Oi(p);if(g.length>0)return{container:p,firstTabbableNode:g[0],lastTabbableNode:g[g.length-1],nextTabbableNode:function(T){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,z=S.findIndex(function(X){return X===T});return x?S.slice(z+1).find(function(X){return ye(X)}):S.slice(0,z).reverse().find(function(X){return ye(X)})}}}).filter(function(p){return!!p}),n.tabbableGroups.length<=0&&!l("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},d=function _(p){if(p!==!1&&p!==s.activeElement){if(!p||!p.focus){_(u());return}p.focus({preventScroll:!!i.preventScroll}),n.mostRecentlyFocusedNode=p,Ni(p)&&p.select()}},f=function(p){var g=l("setReturnFocus",p);return g||(g===!1?!1:p)},b=function(p){var g=_e(p);if(!c(g)){if(ce(i.clickOutsideDeactivates,p)){a.deactivate({returnFocus:i.returnFocusOnDeactivate&&!Re(g)});return}ce(i.allowOutsideClick,p)||p.preventDefault()}},v=function(p){var g=_e(p),S=c(g);S||g instanceof Document?S&&(n.mostRecentlyFocusedNode=g):(p.stopImmediatePropagation(),d(n.mostRecentlyFocusedNode||u()))},w=function(p){var g=_e(p);h();var S=null;if(n.tabbableGroups.length>0){var k=Ne(n.tabbableGroups,function(se){var ie=se.container;return ie.contains(g)}),T=k>=0?n.tabbableGroups[k]:void 0;if(k<0)p.shiftKey?S=n.tabbableGroups[n.tabbableGroups.length-1].lastTabbableNode:S=n.tabbableGroups[0].firstTabbableNode;else if(p.shiftKey){var x=Ne(n.tabbableGroups,function(se){var ie=se.firstTabbableNode;return g===ie});if(x<0&&(T.container===g||Re(g)&&!ye(g)&&!T.nextTabbableNode(g,!1))&&(x=k),x>=0){var z=x===0?n.tabbableGroups.length-1:x-1,X=n.tabbableGroups[z];S=X.lastTabbableNode}}else{var re=Ne(n.tabbableGroups,function(se){var ie=se.lastTabbableNode;return g===ie});if(re<0&&(T.container===g||Re(g)&&!ye(g)&&!T.nextTabbableNode(g))&&(re=k),re>=0){var dr=re===n.tabbableGroups.length-1?0:re+1,hr=n.tabbableGroups[dr];S=hr.firstTabbableNode}}}else S=l("fallbackFocus");S&&(p.preventDefault(),d(S))},A=function(p){if($i(p)&&ce(i.escapeDeactivates,p)!==!1){p.preventDefault(),a.deactivate();return}if(Di(p)){w(p);return}},I=function(p){if(!ce(i.clickOutsideDeactivates,p)){var g=_e(p);c(g)||ce(i.allowOutsideClick,p)||(p.preventDefault(),p.stopImmediatePropagation())}},$=function(){if(!!n.active)return _t.activateTrap(a),n.delayInitialFocusTimer=i.delayInitialFocus?bt(function(){d(u())}):d(u()),s.addEventListener("focusin",v,!0),s.addEventListener("mousedown",b,{capture:!0,passive:!1}),s.addEventListener("touchstart",b,{capture:!0,passive:!1}),s.addEventListener("click",I,{capture:!0,passive:!1}),s.addEventListener("keydown",A,{capture:!0,passive:!1}),a},B=function(){if(!!n.active)return s.removeEventListener("focusin",v,!0),s.removeEventListener("mousedown",b,!0),s.removeEventListener("touchstart",b,!0),s.removeEventListener("click",I,!0),s.removeEventListener("keydown",A,!0),a};return a={activate:function(p){if(n.active)return this;var g=o(p,"onActivate"),S=o(p,"onPostActivate"),k=o(p,"checkCanFocusTrap");k||h(),n.active=!0,n.paused=!1,n.nodeFocusedBeforeActivation=s.activeElement,g&&g();var T=function(){k&&h(),$(),S&&S()};return k?(k(n.containers.concat()).then(T,T),this):(T(),this)},deactivate:function(p){if(!n.active)return this;clearTimeout(n.delayInitialFocusTimer),n.delayInitialFocusTimer=void 0,B(),n.active=!1,n.paused=!1,_t.deactivateTrap(a);var g=o(p,"onDeactivate"),S=o(p,"onPostDeactivate"),k=o(p,"checkCanReturnFocus");g&&g();var T=o(p,"returnFocus","returnFocusOnDeactivate"),x=function(){bt(function(){T&&d(f(n.nodeFocusedBeforeActivation)),S&&S()})};return T&&k?(k(f(n.nodeFocusedBeforeActivation)).then(x,x),this):(x(),this)},pause:function(){return n.paused||!n.active?this:(n.paused=!0,B(),this)},unpause:function(){return!n.paused||!n.active?this:(n.paused=!1,h(),$(),this)},updateContainerElements:function(p){var g=[].concat(p).filter(Boolean);return n.containers=g.map(function(S){return typeof S=="string"?s.querySelector(S):S}),n.active&&h(),this}},a.updateContainerElements(t),a};const q={base:"esri-identity-modal",open:"esri-identity-modal--open",closed:"esri-identity-modal--closed",title:"esri-identity-modal__title",dialog:"esri-identity-modal__dialog",content:"esri-identity-modal__content",closeButton:"esri-identity-modal__close-button",iconClose:"esri-icon-close"};let W=class extends tr{constructor(e,t){super(e,t),this.container=document.createElement("div"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch("open",()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}render(){const e=this.id,{open:t,content:r,title:s,messages:i}=this,n=t&&!!r,a={[q.open]:n,[q.closed]:!n},o=R("button",{class:q.closeButton,"aria-label":i.close,title:i.close,bind:this,onclick:this._close},R("span",{"aria-hidden":"true",class:q.iconClose})),c=`${e}_title`,l=`${e}_content`,u=s?R("h1",{id:c,class:q.title},s):null,h=n?R("div",{bind:this,class:q.dialog,role:"dialog","aria-labelledby":c,"aria-describedby":l,afterCreate:this._createFocusTrap},o,u,this._renderContent(l)):null;return R("div",{tabIndex:-1,class:this.classes(q.base,a)},h)}_destroyFocusTrap(){var e;(e=this._focusTrap)==null||e.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:t}=this;e&&(t?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const t=requestAnimationFrame(()=>{this._focusTrap=Li(e,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.own(It(()=>cancelAnimationFrame(t)))}_renderContent(e){const t=this.content;return typeof t=="string"?R("div",{class:q.content,id:e,innerHTML:t}):yi(t)?R("div",{class:q.content,id:e},t.render()):t instanceof HTMLElement?R("div",{class:q.content,id:e,bind:t,afterCreate:this._attachToNode}):null}_attachToNode(e){const t=this;e.appendChild(t)}};m([y({readOnly:!0})],W.prototype,"container",void 0),m([y()],W.prototype,"content",void 0),m([y()],W.prototype,"open",void 0),m([y(),rr("esri/t9n/common")],W.prototype,"messages",void 0),m([y({aliasOf:"messages.auth.signIn"})],W.prototype,"title",void 0),W=m([te("esri.identity.IdentityModal")],W);const wt=W,$e="esriJSAPIOAuth";class He{constructor(t,r){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=r,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.token&&this.userId){const r=Date.now();this.expires>r&&(this.expires-r)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}return t}save(){if(!this.storage)return;const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let s=t[r.authNamespace];s||(s=t[r.authNamespace]={}),s[r.portalUrl]={appId:this.appId=r.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem($e,JSON.stringify(t))}catch(i){console.log(i)}}}destroy(){const t=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&this.token&&this.expires>Date.now()){const s=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.token),i.append("client_id",r.appId),i.append("token_type_hint","access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(s,i);else{const n=new XMLHttpRequest;n.open("POST",s),n.send(i)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage){const s=t[r.authNamespace];if(s){delete s[r.portalUrl];try{this.storage.setItem($e,JSON.stringify(t))}catch(i){console.log(i)}}}r&&(r._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let s=t[r.authNamespace];s&&(s=s[r.portalUrl],s&&(this.appId=s.appId,this.expires=s.expires,this.ssl=s.ssl,this.token=s.token,this.userId=s.userId))}}_load(){let t={};if(this.storage){const r=this.storage.getItem($e);if(r)try{t=JSON.parse(r)}catch(s){console.log(s)}}return t}}He.prototype.declaredClass="esri.identity.OAuthCredential";var ze;let N=ze=class extends kt{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return ze.fromJSON(this.toJSON())}};m([y({json:{write:!0}})],N.prototype,"appId",void 0),m([y({json:{write:!0}})],N.prototype,"authNamespace",void 0),m([y({json:{write:!0}})],N.prototype,"expiration",void 0),m([y({json:{write:!0}})],N.prototype,"forceLogin",void 0),m([y({json:{write:!0}})],N.prototype,"forceUserId",void 0),m([y({json:{write:!0}})],N.prototype,"locale",void 0),m([y({json:{write:!0}})],N.prototype,"minTimeUntilExpiration",void 0),m([y({json:{write:!0}})],N.prototype,"popup",void 0),m([y({json:{write:!0}})],N.prototype,"popupCallbackUrl",void 0),m([y({json:{write:!0}})],N.prototype,"popupWindowFeatures",void 0),m([y({json:{write:!0}})],N.prototype,"portalUrl",void 0),m([y({json:{write:!0}})],N.prototype,"preserveUrlHash",void 0),m([y({json:{write:!0}})],N.prototype,"userId",void 0),N=ze=m([te("esri.identity.OAuthInfo")],N);const St=N;let L=class extends kt{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};m([y({json:{write:!0}})],L.prototype,"adminTokenServiceUrl",void 0),m([y({json:{write:!0}})],L.prototype,"currentVersion",void 0),m([y({json:{write:!0}})],L.prototype,"hasPortal",void 0),m([y({json:{write:!0}})],L.prototype,"hasServer",void 0),m([y({json:{write:!0}})],L.prototype,"owningSystemUrl",void 0),m([y({json:{write:!0}})],L.prototype,"owningTenant",void 0),m([y({json:{write:!0}})],L.prototype,"server",void 0),m([y({json:{write:!0}})],L.prototype,"shortLivedTokenValidity",void 0),m([y({json:{write:!0}})],L.prototype,"tokenServiceUrl",void 0),m([y({json:{write:!0}})],L.prototype,"webTierAuth",void 0),L=m([te("esri.identity.ServerInfo")],L);const De=L,we={},lr=e=>{const t=new J(e.owningSystemUrl).host,r=new J(e.server).host,s=/.+\.arcgis\.com$/i;return s.test(t)&&s.test(r)},Ve=(e,t)=>!!(lr(e)&&t&&t.some(r=>r.test(e.server)));let Se=null,Ae=null;try{Se=window.localStorage,Ae=window.sessionStorage}catch{}class cr extends Me{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=mi,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=nt(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener("pageshow",t=>{this._pageShowHandler(t)})}registerServers(t){const r=this.serverInfos;r?(t=t.filter(s=>!this.findServerInfo(s.server)),this.serverInfos=r.concat(t)):this.serverInfos=t,t.forEach(s=>{s.owningSystemUrl&&this._portals.push(s.owningSystemUrl),s.hasPortal&&this._portals.push(s.server)})}registerOAuthInfos(t){const r=this.oAuthInfos;if(r){for(const s of t){const i=this.findOAuthInfo(s.portalUrl);i&&r.splice(r.indexOf(i),1)}this.oAuthInfos=r.concat(t)}else this.oAuthInfos=t}registerToken(t){t=F({},t);const r=this._sanitizeUrl(t.server),s=this._isServerRsrc(r);let i,n=this.findServerInfo(r),a=!0;n||(n=new De,n.server=this._getServerInstanceRoot(r),s?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(r),n.hasPortal=!0),this.registerServers([n])),i=this._findCredential(r),i?(delete t.server,Object.assign(i,t),a=!1):(i=new C({userId:t.userId,server:n.server,token:t.token,expires:t.expires,ssl:t.ssl,scope:s?"server":"portal"}),i.resources=[r],this.credentials.push(i)),i.emitTokenChange(!1),a||i.refreshServerTokens()}toJSON(){return Tt({serverInfos:this.serverInfos.map(t=>t.toJSON()),oAuthInfos:this.oAuthInfos.map(t=>t.toJSON()),credentials:this.credentials.map(t=>t.toJSON())})}initialize(t){if(!t)return;typeof t=="string"&&(t=JSON.parse(t));const r=t.serverInfos,s=t.oAuthInfos,i=t.credentials;if(r){const n=[];r.forEach(a=>{a.server&&a.tokenServiceUrl&&n.push(a.declaredClass?a:new De(a))}),n.length&&this.registerServers(n)}if(s){const n=[];s.forEach(a=>{a.appId&&n.push(a.declaredClass?a:new St(a))}),n.length&&this.registerOAuthInfos(n)}i&&i.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new C(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(t){let r;t=this._sanitizeUrl(t);for(const s of this.serverInfos)if(this._hasSameServerInstance(s.server,t)){r=s;break}return r}findOAuthInfo(t){let r;t=this._sanitizeUrl(t);for(const s of this.oAuthInfos)if(this._hasSameServerInstance(s.portalUrl,t)){r=s;break}return r}findCredential(t,r){let s;t=this._sanitizeUrl(t);const i=this._isServerRsrc(t)?"server":"portal";if(r){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&r===n.userId&&n.scope===i){s=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&this._getIdenticalSvcIdx(t,n)!==-1&&n.scope===i){s=n;break}return s}getCredential(t,r){let s,i,n=!0;r&&(s=!!r.token,i=r.error,n=r.prompt!==!1),r=F({},r),t=this._sanitizeUrl(t);const a=new AbortController,o=he();if(r.signal&&ne(r.signal,()=>{a.abort()}),ne(a,()=>{o.reject(new E("identity-manager:user-aborted","ABORTED"))}),Rr(a))return o.promise;r.signal=a.signal;const c=this._isAdminResource(t),l=s?this.findCredential(t):null;let u;if(l&&i&&i.details&&i.details.httpStatus===498)l.destroy();else if(l)return u=new E("identity-manager:not-authorized","You are currently signed in as: '"+l.userId+"'. You do not have access to this resource: "+t,{error:i}),o.reject(u),o.promise;const h=this._findCredential(t,r);if(h)return o.resolve(h),o.promise;let d=this.findServerInfo(t);if(d)!d.hasServer&&this._isServerRsrc(t)&&(d._restInfoPms=this._getTokenSvcUrl(t),d.hasServer=!0);else{const f=this._getTokenSvcUrl(t);if(!f)return u=new E("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),o.reject(u),o.promise;d=new De,d.server=this._getServerInstanceRoot(t),typeof f=="string"?(d.tokenServiceUrl=f,d.hasPortal=!0):(d._restInfoPms=f,d.hasServer=!0),this.registerServers([d])}return d.hasPortal&&d._selfReq===void 0&&(n||V(d.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(f=>f.tokenServiceUrl===d.tokenServiceUrl))&&(d._selfReq={owningTenant:r&&r.owningTenant,selfDfd:this._getPortalSelf(d.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),t)}),this._enqueue(t,d,r,o,c)}getResourceName(t){return this._isRESTService(t)?t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(t)&&t.replace(this._gwUser,"$1")||this._gwItem.test(t)&&t.replace(this._gwItem,"$1")||this._gwGroup.test(t)&&t.replace(this._gwGroup,"$1")||""}generateToken(t,r,s){const i=this._rePortalTokenSvc.test(t.tokenServiceUrl),n=new J(this._appOrigin),a=t.shortLivedTokenValidity;let o,c,l,u,h,d,f,b;r&&(b=this.tokenValidity||a||this.defaultTokenValidity,b>a&&a>0&&(b=a)),s&&(o=s.isAdmin,c=s.serverUrl,l=s.token,d=s.signal,f=s.ssl,t.customParameters=s.customParameters),o?u=t.adminTokenServiceUrl:(u=t.tokenServiceUrl,h=new J(u.toLowerCase()),t.webTierAuth&&s!=null&&s.serverUrl&&!f&&n.scheme==="http"&&(V(n.uri,u,!0)||h.scheme==="https"&&n.host===h.host&&n.port==="7080"&&h.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const v=F({query:F({request:"getToken",username:r==null?void 0:r.username,password:r==null?void 0:r.password,serverUrl:c,token:l,expiration:b,referer:o||i?this._appOrigin:null,client:o?"referer":null,f:"json"},t.customParameters),method:"post",authMode:"anonymous",useProxy:this._useProxy(t,s),signal:d},s==null?void 0:s.ioArgs);return i||(v.withCredentials=!1),M(u,v).then(w=>{const A=w.data;if(!A||!A.token)return new E("identity-manager:authentication-failed","Unable to generate token");const I=t.server;return we[I]||(we[I]={}),r&&(we[I][r.username]=r.password),A.validity=b,A})}isBusy(){return!!this._busy}checkSignInStatus(t){return this.checkAppAccess(t,"").then(r=>r.credential)}checkAppAccess(t,r,s){let i=!1;return this.getCredential(t,{prompt:!1}).then(n=>{let a;const o={f:"json"};if(n.scope==="portal")if(r&&(this._doPortalSignIn(t)||s&&s.force))a=n.server+"/sharing/rest/oauth2/validateAppAccess",o.client_id=r;else{if(!n.token)return{credential:n};a=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};a=n.server+"/rest/services"}return n.token&&(o.token=n.token),M(a,{query:o,authMode:"anonymous"}).then(c=>{if(c.data.valid===!1)throw new E("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,c.data);return i=!!c.data.viewOnlyUserTypeApp,{credential:n}}).catch(c=>{if(c.name==="identity-manager:not-authorized")throw c;const l=c.details&&c.details.httpStatus;if(l===498)throw n.destroy(),new E("identity-manager:not-authenticated","User is not signed in.");if(l===400)throw new E("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:i}))}setOAuthResponseHash(t){var r;const s=this._oAuthDfd;if(this._oAuthDfd=null,!s||!t)return;clearInterval(this._oAuthIntervalId),(r=this._oAuthOnHashHandle)==null||r.remove(),t.charAt(0)==="#"&&(t=t.substring(1));const i=ot(t);if(i.error){const n=i.error==="access_denied",a=new E(n?"identity-manager:user-aborted":"identity-manager:authentication-failed",n?"ABORTED":"OAuth: "+i.error+" - "+i.error_description);s.reject(a)}else{const n=s.sinfo_,a=s.oinfo_,o=a._oAuthCred,c=new C({userId:i.username,server:n.server,token:i.access_token,expires:Date.now()+1e3*Number(i.expires_in),ssl:i.ssl==="true",_oAuthCred:o});a.userId=c.userId,o.storage=i.persist?Se:Ae,o.token=c.token,o.expires=c.expires,o.userId=c.userId,o.ssl=c.ssl,o.save(),s.resolve(c)}}setOAuthRedirectionHandler(t){this._oAuthRedirectFunc=t}setProtocolErrorHandler(t){this._protocolFunc=t}signIn(t,r,s={}){const i=he(),n=()=>{var h,d,f,b,v;(h=c)==null||h.remove(),(d=l)==null||d.remove(),(f=u)==null||f.remove(),(b=o)==null||b.destroy(),(v=this.dialog)==null||v.destroy(),this.dialog=o=c=l=u=null},a=()=>{n(),this._oAuthDfd=null,i.reject(new E("identity-manager:user-aborted","ABORTED"))};s.signal&&ne(s.signal,()=>{a()});let o=new this.formConstructor;o.resource=this.getResourceName(t),o.server=r.server,this.dialog=new wt,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");let c=o.on("cancel",a),l=this.dialog.watch("open",a),u=o.on("submit",h=>{this.generateToken(r,h,{isAdmin:s.isAdmin,signal:s.signal}).then(d=>{n();const f=new C({userId:h.username,server:r.server,token:d.token,expires:d.expires!=null?Number(d.expires):null,ssl:!!d.ssl,isAdmin:s.isAdmin,validity:d.validity});i.resolve(f)}).catch(d=>{o.error=d,o.signingIn=!1})});return i.promise}oAuthSignIn(t,r,s,i){this._oAuthDfd=he();const n=this._oAuthDfd;i!=null&&i.signal&&ne(i.signal,()=>{const f=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;f&&!f.closed?f.close():this.dialog&&c()}),n.resUrl_=t,n.sinfo_=r,n.oinfo_=s;const a=!i||i.oAuthPopupConfirmation!==!1;if(!s.popup||!a)return this._doOAuthSignIn(t,r,s),n.promise;const o=new this.formConstructor;o.oAuthPrompt=!0,o.server=r.server,this.dialog=new wt,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");const c=()=>{d(),this._oAuthDfd=null,n.reject(new E("identity-manager:user-aborted","ABORTED"))},l=o.on("cancel",c),u=this.dialog.watch("open",c),h=o.on("submit",()=>{d(),this._doOAuthSignIn(t,r,s)}),d=()=>{l.remove(),u.remove(),h.remove(),o.destroy(),this.dialog.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(t=>{t.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(t="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=Ue(window,"message",r=>{var s;if((r.origin===this._appOrigin||r.origin.endsWith(".arcgis.com"))&&((s=r.data)==null?void 0:s.type)==="arcgis:auth:requestCredential"){const i=r.source;this.getCredential(t).then(n=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:n.expires,server:n.server,ssl:n.ssl,token:n.token,userId:n.userId}},r.origin)}).catch(n=>{i.postMessage({type:"arcgis:auth:error",error:{name:n.name,message:n.message}},r.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthHash(){let t=window.location.hash;if(t){t.charAt(0)==="#"&&(t=t.substring(1));const r=ot(t);let s=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),typeof r.state=="object"&&r.state.portalUrl&&(this._oAuthHash=r,s=!0)}catch{}else r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(s=!0));s&&(window.location.hash=typeof r.state=="object"&&r.state.hash||"")}}_pageShowHandler(t){if(t.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const r=new E("identity-manager:user-aborted","ABORTED");this._errbackFunc(r)}}_findCredential(t,r){let s,i,n,a,o=-1;const c=r&&r.token,l=r&&r.resource,u=this._isServerRsrc(t)?"server":"portal",h=this.credentials.filter(d=>this._hasSameServerInstance(d.server,t)&&d.scope===u);if(t=l||t,h.length)if(h.length===1){if(s=h[0],a=this.findServerInfo(s.server),i=a&&a.owningSystemUrl,n=i&&this.findCredential(i,s.userId),o=this._getIdenticalSvcIdx(t,s),!c)return o===-1&&s.resources.push(t),this._addResource(t,n),s;o!==-1&&(s.resources.splice(o,1),this._removeResource(t,n))}else{let d,f;if(h.some(b=>(f=this._getIdenticalSvcIdx(t,b),f!==-1&&(d=b,a=this.findServerInfo(d.server),i=a&&a.owningSystemUrl,n=i&&this.findCredential(i,d.userId),o=f,!0))),c)d&&(d.resources.splice(o,1),this._removeResource(t,n));else if(d)return this._addResource(t,n),d}}_findOAuthInfo(t){let r=this.findOAuthInfo(t);if(!r){for(const s of this.oAuthInfos)if(this._isIdProvider(s.portalUrl,t)){r=s;break}}return r}_addResource(t,r){r&&this._getIdenticalSvcIdx(t,r)===-1&&r.resources.push(t)}_removeResource(t,r){let s=-1;r&&(s=this._getIdenticalSvcIdx(t,r),s>-1&&r.resources.splice(s,1))}_useProxy(t,r){return r&&r.isAdmin&&!V(t.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(t.tokenServiceUrl)&&String(t.currentVersion)==="10.1"&&!V(t.tokenServiceUrl,this._appOrigin)}_getOrigin(t){const r=new J(t);return r.scheme+"://"+r.host+(r.port!=null?":"+r.port:"")}_getServerInstanceRoot(t){const r=t.toLowerCase();let s=r.indexOf(this._agsRest);return s===-1&&this._isAdminResource(t)&&(s=this._agsAdmin.test(t)?t.replace(this._agsAdmin,"$1").length:t.search(this._adminSvcs)),s===-1&&(s=r.indexOf("/sharing")),s===-1&&r.substr(-1)==="/"&&(s=r.length-1),s>-1?t.substring(0,s):t}_hasSameServerInstance(t,r){return t.substr(-1)==="/"&&(t=t.slice(0,-1)),t=t.toLowerCase(),r=this._getServerInstanceRoot(r).toLowerCase(),t=this._normalizeAGOLorgDomain(t),r=this._normalizeAGOLorgDomain(r),(t=t.substr(t.indexOf(":")))===(r=r.substr(r.indexOf(":")))}_normalizeAGOLorgDomain(t){const r=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,s=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,i=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return r.test(t)?t=t.replace(r,"https://www.arcgis.com"):s.test(t)?t=t.replace(s,"https://devext.arcgis.com"):i.test(t)&&(t=t.replace(i,"https://qaext.arcgis.com")),t}_sanitizeUrl(t){const r=(Oe.request.proxyUrl||"").toLowerCase(),s=r?t.toLowerCase().indexOf(r+"?"):-1;return s!==-1&&(t=t.substring(s+r.length+1)),t=Nr(t),nt(t).path}_isRESTService(t){return t.indexOf(this._agsRest)>-1}_isAdminResource(t){return this._agsAdmin.test(t)||this._adminSvcs.test(t)}_isServerRsrc(t){return this._isRESTService(t)||this._isAdminResource(t)}_isIdenticalService(t,r){let s;if(this._isRESTService(t)&&this._isRESTService(r)){const i=this._getSuffix(t).toLowerCase(),n=this._getSuffix(r).toLowerCase();if(s=i===n,!s){const a=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;s=i.replace(a,"$1")===n.replace(a,"$1")}}else this._isAdminResource(t)&&this._isAdminResource(r)?s=!0:this._isServerRsrc(t)||this._isServerRsrc(r)||!this._isPortalDomain(t)||(s=!0);return s}_isPortalDomain(t){const r=new J(t.toLowerCase()),s=this._portalConfig;let i=this._gwDomains.some(n=>n.regex.test(r.uri));return!i&&s&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),r.uri)),i||Oe.portalUrl&&(i=V(r,Oe.portalUrl,!0)),i||(i=this._portals.some(n=>this._hasSameServerInstance(n,r.uri))),i=i||this._agsPortal.test(r.path),i}_isIdProvider(t,r){let s=-1,i=-1;this._gwDomains.forEach((a,o)=>{s===-1&&a.regex.test(t)&&(s=o),i===-1&&a.regex.test(r)&&(i=o)});let n=!1;if(s>-1&&i>-1&&(s===0||s===4?i!==0&&i!==4||(n=!0):s===1?i!==1&&i!==2||(n=!0):s===2?i===2&&(n=!0):s===3&&i===3&&(n=!0)),!n){const a=this.findServerInfo(r),o=a&&a.owningSystemUrl;o&&lr(a)&&this._isPortalDomain(o)&&this._isIdProvider(t,o)&&(n=!0)}return n}_getIdenticalSvcIdx(t,r){let s=-1;for(let i=0;i<r.resources.length;i++){const n=r.resources[i];if(this._isIdenticalService(t,n)){s=i;break}}return s}_getSuffix(t){return t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(t){let r,s,i;if(this._isRESTService(t)||this._isAdminResource(t)){const n=this._getServerInstanceRoot(t);return r=n+"/admin/generateToken",s=M(t=n+"/rest/info",{query:{f:"json"}}).then(a=>a.data),{adminUrl:r,promise:s}}if(this._isPortalDomain(t)){let n="";if(this._gwDomains.some(a=>(a.regex.test(t)&&(n=a.tokenServiceUrl),!!n)),n||this._portals.some(a=>(this._hasSameServerInstance(a,t)&&(n=a+this._gwTokenUrl),!!n)),n||(i=t.toLowerCase().indexOf("/sharing"),i!==-1&&(n=t.substring(0,i)+this._gwTokenUrl)),n||(n=this._getOrigin(t)+this._gwTokenUrl),n){const a=new J(t).port;/^http:\/\//i.test(t)&&a==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}if(t.toLowerCase().indexOf("premium.arcgisonline.com")!==-1)return"https://premium.arcgisonline.com/server/tokens"}_exchangeToken(t,r,s){return M(`${t}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:r,token:s}}).then(i=>i.data.token)}_getPlatformSelf(t,r){return t=t.replace(/^http:/i,"https:"),M(`${t}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":r,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json"},withCredentials:!0}).then(s=>s.data)}_getPortalSelf(t,r){let s;return this._gwDomains.some(i=>(i.regex.test(t)&&(s=i.customBaseUrl),!!s)),s?Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:s,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?t=t.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(r)&&(t=t.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),M(t,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(i=>i.data))}_doPortalSignIn(t){const r=this._portalConfig,s=window.location.href,i=this.findServerInfo(t);return!(!r&&!this._isPortalDomain(s)||!(i?i.hasPortal||i.owningSystemUrl&&this._isPortalDomain(i.owningSystemUrl):this._isPortalDomain(t))||!(this._isIdProvider(s,t)||r&&(this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),t)||this._isIdProvider(r.restBaseUrl,t))||V(s,t,!0)))}_checkProtocol(t,r,s,i){let n=!0;const a=i?r.adminTokenServiceUrl:r.tokenServiceUrl;return a.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&$r(a)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:t,serverInfo:r}),!n)&&s(new E("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(t,r,s,i,n,a){return i||(i=he()),i.resUrl_=t,i.sinfo_=r,i.options_=s,i.admin_=n,i.refresh_=a,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(t),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(i)):this._xoReqs.push(i):this._doSignIn(i),i.promise}_doSignIn(t){this._busy=t,this._rejectOnPersistedPageShow=!1;const r=l=>{const u=t.options_&&t.options_.resource,h=t.resUrl_,d=t.refresh_;let f=!1;this.credentials.indexOf(l)===-1&&(d&&this.credentials.indexOf(d)!==-1?(d.userId=l.userId,d.token=l.token,d.expires=l.expires,d.validity=l.validity,d.ssl=l.ssl,d.creationTime=l.creationTime,f=!0,l=d):this.credentials.push(l)),l.resources||(l.resources=[]),l.resources.push(u||h),l.scope=this._isServerRsrc(h)?"server":"portal",l.emitTokenChange();const b=this._soReqs,v={};this._soReqs=[],b.forEach(w=>{if(!this._isIdenticalService(h,w.resUrl_)){const A=this._getSuffix(w.resUrl_);v[A]||(v[A]=!0,l.resources.push(w.resUrl_))}}),t.resolve(l),b.forEach(w=>{this._hasSameServerInstance(this._getServerInstanceRoot(h),w.resUrl_)?w.resolve(l):this._soReqs.push(w)}),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,f||this.emit("credential-create",{credential:l}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=l=>{t.reject(l),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=(l,u,h,d)=>{var f,b;const v=t.sinfo_,w=!t.options_||t.options_.prompt!==!1,A=v.hasPortal&&this._findOAuthInfo(t.resUrl_);let I,$;if(l)r(new C({userId:l,server:v.server,token:h||null,expires:d!=null?Number(d):null,ssl:!!u}));else if(window!==window.parent&&(f=this._appUrlObj.query)!=null&&f["arcgis-auth-origin"]&&(b=this._appUrlObj.query)!=null&&b["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),t.resUrl_)){var B;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const _=Ue(window,"message",p=>{p.source===window.parent&&p.data&&(p.data.type==="arcgis:auth:credential"?(_.remove(),p.data.credential.expires<Date.now()?s(new E("identity-manager:credential-request-failed","Parent application's token has expired.")):r(new C(p.data.credential))):p.data.type==="arcgis:auth:error"&&(_.remove(),p.data.error.name==="tokenExpiredError"?s(new E("identity-manager:credential-request-failed","Parent application's token has expired.")):s(E.fromJSON(p.data.error))))});ne((B=t.options_)==null?void 0:B.signal,()=>{_.remove()})}else if(A){let _=A._oAuthCred;if(!_){const p=new He(A,Se),g=new He(A,Ae);p.isValid()&&g.isValid()?p.expires>g.expires?(_=p,g.destroy()):(_=g,p.destroy()):_=p.isValid()?p:g,A._oAuthCred=_}if(_.isValid())I=new C({userId:_.userId,server:v.server,token:_.token,expires:_.expires,ssl:_.ssl,_oAuthCred:_}),A.appId!==_.appId&&this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._exchangeToken(I.server,A.appId,I.token).then(p=>{I.token=p,_.token=p,_.save(),r(I)}).catch(()=>{r(I)}):r(I);else if(this._oAuthHash&&this._hasSameServerInstance(A.portalUrl,this._oAuthHash.state.portalUrl)){const p=this._oAuthHash;I=new C({userId:p.username,server:v.server,token:p.access_token,expires:Date.now()+1e3*Number(p.expires_in),ssl:p.ssl==="true",oAuthState:p.state,_oAuthCred:_}),A.userId=I.userId,_.storage=p.persist?Se:Ae,_.token=I.token,_.expires=I.expires,_.userId=I.userId,_.ssl=I.ssl,_.save(),this._oAuthHash=null,r(I)}else{const p=()=>{w?t._pendingDfd=this.oAuthSignIn(t.resUrl_,v,A,t.options_).then(r,s):($=new E("identity-manager:not-authenticated","User is not signed in."),s($))};this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._getPlatformSelf(v.server,A.appId).then(({portalUrl:g,token:S,username:k})=>{!g||V(g,this._appOrigin,!0)?(I=new C({server:v.server,userId:k,token:S}),r(I)):p()}).catch(p):p()}}else if(w){if(this._checkProtocol(t.resUrl_,v,s,t.admin_)){let _=t.options_;t.admin_&&(_=_||{},_.isAdmin=!0),t._pendingDfd=this.signIn(t.resUrl_,v,_).then(r,s)}}else $=new E("identity-manager:not-authenticated","User is not signed in."),s($)},n=()=>{const l=t.sinfo_,u=l.owningSystemUrl,h=t.options_;let d,f,b,v;if(h&&(d=h.token,f=h.error,b=h.prompt),v=this._findCredential(u,{token:d,resource:t.resUrl_}),!v){for(const w of this.credentials)if(this._isIdProvider(u,w.server)){v=w;break}}if(v){const w=this.findCredential(t.resUrl_,v.userId);if(w)r(w);else if(Ve(l,this._legacyFed)){const A=v.toJSON();A.server=l.server,A.resources=null,r(new C(A))}else(t._pendingDfd=this.generateToken(this.findServerInfo(v.server),null,{serverUrl:t.resUrl_,token:v.token,signal:t.options_.signal,ssl:v.ssl})).then(A=>{r(new C({userId:v.userId,server:l.server,token:A.token,expires:A.expires!=null?Number(A.expires):null,ssl:!!A.ssl,isAdmin:t.admin_,validity:A.validity}))},s)}else this._busy=null,d&&(t.options_.token=null),(t._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:t.resUrl_,owningTenant:l.owningTenant,signal:t.options_.signal,token:d,error:f,prompt:b})).then(()=>{this._enqueue(t.resUrl_,t.sinfo_,t.options_,t,t.admin_)},w=>{t.resUrl_=t.sinfo_=t.refresh_=null,t.reject(w)})};this._errbackFunc=s;const a=t.sinfo_.owningSystemUrl,o=this._isServerRsrc(t.resUrl_),c=t.sinfo_._restInfoPms;c?c.promise.then(l=>{const u=t.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=fe("authInfo.tokenServicesUrl",l)||fe("authInfo.tokenServiceUrl",l)||fe("tokenServiceUrl",l),u.shortLivedTokenValidity=fe("authInfo.shortLivedTokenValidity",l),u.currentVersion=l.currentVersion,u.owningTenant=l.owningTenant;const h=u.owningSystemUrl=l.owningSystemUrl;h&&this._portals.push(h)}o&&u.owningSystemUrl?n():i()},()=>{t.sinfo_._restInfoPms=null;const l=new E("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");s(l)}):o&&a?n():t.sinfo_._selfReq?t.sinfo_._selfReq.selfDfd.then(l=>{const u={};let h,d,f,b;return l&&(h=l.user&&l.user.username,u.username=h,u.allSSL=l.allSSL,d=l.supportsOAuth,f=l.currentVersion,l.portalMode==="multitenant"&&(b=l.customBaseUrl)),t.sinfo_.webTierAuth=!!h,h&&this.normalizeWebTierAuth?this.generateToken(t.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(v=>(u.portalToken=v&&v.token,u.tokenExpiration=v&&v.expires,u)):!h&&d&&parseFloat(f)>=4.4&&!this._findOAuthInfo(t.resUrl_)?this._generateOAuthInfo({portalUrl:t.sinfo_.server,customBaseUrl:b,owningTenant:t.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(l=>{t.sinfo_._selfReq=null,l?i(l.username,l.allSSL,l.portalToken,l.tokenExpiration):i()}):i()}_generateOAuthInfo(t){let r,s,i=t.portalUrl;const n=t.customBaseUrl,a=t.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){s=window.location.href;let c=s.indexOf("?");c>-1&&(s=s.slice(0,c)),c=s.search(/\/(apps|home)\//),s=c>-1?s.slice(0,c):null}return o&&s?(this._hasTestedIfAppIsOnPortal=!0,r=M(s+"/sharing/rest",{query:{f:"json"}}).then(()=>{this.defaultOAuthInfo=new St({appId:"arcgisonline",popupCallbackUrl:s+"/home/oauth-callback.html"})})):r=Promise.resolve(),r.then(()=>{if(this.defaultOAuthInfo)return i=i.replace(/^http:/i,"https:"),M(i+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:a,client_id:this.defaultOAuthInfo.appId,redirect_uri:Le(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(c=>{if(c.data.valid){const l=this.defaultOAuthInfo.clone();c.data.urlKey&&n?l.portalUrl="https://"+c.data.urlKey.toLowerCase()+"."+n:l.portalUrl=i,l.popup=window!==window.top||!(V(i,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(i)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(l)}})})}_doOAuthSignIn(t,r,s){const i={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(i.hash=window.location.hash);const n={client_id:s.appId,response_type:"token",state:JSON.stringify(i),expiration:s.expiration,locale:s.locale,redirect_uri:s.popup?Le(s.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};s.forceLogin&&(n.force_login=!0),s.forceUserId&&s.userId&&(n.prepopulatedusername=s.userId),!s.popup&&this._doPortalSignIn(t)&&(n.redirectToUserOrgUrl=!0);const a=s.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",o=a+"?"+Dr(n);if(s.popup){const c=window.open(o,"esriJSAPIOAuth",s.popupWindowFeatures);if(c)c.focus(),this._oAuthDfd.oAuthWin_=c,this._oAuthIntervalId=setInterval(()=>{if(c.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const l=this._oAuthDfd;if(l){const u=new E("identity-manager:user-aborted","ABORTED");l.reject(u)}}},500),this._oAuthOnHashHandle=Ue(window,"arcgis:auth:hash",l=>{this.setOAuthResponseHash(l.detail)});else{const l=new E("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(l)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:n,authorizeUrl:a,resourceUrl:t,serverInfo:r,oAuthInfo:s}):window.location.href=o}}cr.prototype.declaredClass="esri.identity.IdentityManagerBase";let C=class extends Me.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const e=O.findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&this.scope==="server",s=r&&Ve(e,O._legacyFed),i=e.webTierAuth,n=i&&O.normalizeWebTierAuth,a=we[this.server],o=a&&a[this.userId];let c,l=this.resources&&this.resources[0],u=r&&O.findServerInfo(t),h={username:this.userId,password:o};if(i&&!n)return;r&&!u&&O.serverInfos.some(f=>(O._isIdProvider(t,f.server)&&(u=f),!!u));const d=u&&O.findCredential(u.server,this.userId);if(!r||d){if(!s){if(r)c={serverUrl:l,token:d&&d.token,ssl:d&&d.ssl};else if(n)h=null,c={ssl:this.ssl};else{if(!o){let f;return l&&(l=O._sanitizeUrl(l),this._enqueued=1,f=O._enqueue(l,e,null,null,this.isAdmin,this),f.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),f}this.isAdmin&&(c={isAdmin:!0})}return O.generateToken(r?u:e,r?null:h,c).then(f=>{this.token=f.token,this.expires=f.expires!=null?Number(f.expires):null,this.creationTime=Date.now(),this.validity=f.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}d.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&O.credentials.forEach(e=>{const t=O.findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&e.scope==="server"&&(O._hasSameServerInstance(this.server,r)||O._isIdProvider(r,this.server))&&(Ve(t,O._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&O.findServerInfo(this.server),r=t&&t.owningSystemUrl,s=r&&O.findServerInfo(r);e===!1||r&&this.scope!=="portal"&&(!s||!s.webTierAuth||O.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=O.credentials.indexOf(this);e>-1&&O.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const e=Tt({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let r=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();r<0?r=0:r>t&&(r=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),r>e?r-e:r)}};m([y()],C.prototype,"creationTime",void 0),m([y()],C.prototype,"expires",void 0),m([y()],C.prototype,"isAdmin",void 0),m([y()],C.prototype,"oAuthState",void 0),m([y()],C.prototype,"resources",void 0),m([y()],C.prototype,"scope",void 0),m([y()],C.prototype,"server",void 0),m([y()],C.prototype,"ssl",void 0),m([y()],C.prototype,"token",void 0),m([y()],C.prototype,"tokenRefreshBuffer",void 0),m([y()],C.prototype,"userId",void 0),m([y()],C.prototype,"validity",void 0),C=m([te("esri.identity.Credential")],C);class ur extends cr{}ur.prototype.declaredClass="esri.identity.IdentityManager";const Fi=new ur;Lr(Fi);export{Fi as default};
