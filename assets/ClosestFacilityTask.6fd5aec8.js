var J=Object.defineProperty,j=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var R=(r,e,s)=>e in r?J(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,m=(r,e)=>{for(var s in e||(e={}))w.call(e,s)&&R(r,s,e[s]);if($)for(var s of $(e))O.call(e,s)&&R(r,s,e[s]);return r},g=(r,e)=>j(r,k(e));import{_ as i,$ as o,bb as b,bz as p,I as x,W as I,H as A,a0 as N,ap as T,ai as q,J as E,E as z,N as H}from"./vendor.b8b0b9ef.js";import{c as K,a as M,u as c,d as Q,b as V,p as W,o as Z}from"./networkService.50c5d234.js";import{v as _}from"./normalizeUtils.7353462f.js";import{o as D}from"./utils.931ca8bb.js";import{l as G}from"./Task.b8d888f6.js";import"./GPMessage.9d5ad170.js";function L(r){return r.features.map(e=>{const s=E.fromJSON(r.spatialReference),n=A.fromJSON(e);return z(n.geometry)&&(n.geometry.spatialReference=s),n})}function f(r){return q.fromJSON(r).features.map(e=>e.geometry)}let t=class extends T{constructor(r){super(r),this.directions=null,this.facilities=null,this.incidents=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routes=null}readFacilities(r){return f(r)}readIncidents(r){return f(r)}readPointBarriers(r,e){return f(e.barriers)}readPolylineBarriers(r){return f(r)}readPolygonBarriers(r){return f(r)}readRoutes(r){return L(r)}};i([o({type:[K]})],t.prototype,"directions",void 0),i([o({type:[b]})],t.prototype,"facilities",void 0),i([p("facilities")],t.prototype,"readFacilities",null),i([o({type:[b]})],t.prototype,"incidents",void 0),i([p("incidents")],t.prototype,"readIncidents",null),i([o({type:[M]})],t.prototype,"messages",void 0),i([o({type:[b]})],t.prototype,"pointBarriers",void 0),i([p("pointBarriers",["barriers"])],t.prototype,"readPointBarriers",null),i([o({type:[x]})],t.prototype,"polylineBarriers",void 0),i([p("polylineBarriers")],t.prototype,"readPolylineBarriers",null),i([o({type:[I]})],t.prototype,"polygonBarriers",void 0),i([p("polygonBarriers")],t.prototype,"readPolygonBarriers",null),i([o({type:[A]})],t.prototype,"routes",void 0),i([p("routes")],t.prototype,"readRoutes",null),t=i([N("esri.rest.support.ClosestFacilitySolveResult")],t);const U=t,X=Z({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},facilities:!0,incidents:!0,outSpatialReference:{name:"outSR",getter:r=>r.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},returnPointBarriers:{name:"returnBarriers"},returnRoutes:{name:"returnCFRoutes"},travelMode:!0});async function Y(r,e,s){const n=[],u=[],l={},y={},h=D(r),{path:v}=h;e.incidents&&e.incidents.features&&c(e.incidents.features,u,"incidents.features",l),e.facilities&&e.facilities.features&&c(e.facilities.features,u,"facilities.features",l),e.pointBarriers&&e.pointBarriers.features&&c(e.pointBarriers.features,u,"pointBarriers.features",l),e.polylineBarriers&&e.polylineBarriers.features&&c(e.polylineBarriers.features,u,"polylineBarriers.features",l),e.polygonBarriers&&e.polygonBarriers.features&&c(e.polygonBarriers.features,u,"polygonBarriers.features",l);const P=await _(u);for(const a in l){const d=l[a];n.push(a),y[a]=P.slice(d[0],d[1])}if(Q(y,n)){let a=null;try{a=await V(v,e.apiKey,s)}catch{}a&&!a.hasZ&&W(y,n)}for(const a in y)y[a].forEach((d,C)=>{e.get(a)[C].geometry=d});const S=g(m({},s),{query:g(m(m({},h.query),X.toQueryParams(e)),{f:"json"})}),{data:F}=await H(`${v}/solveClosestFacility`,S);return U.fromJSON(F)}let B=class extends G{constructor(r){super(r),this.url=null}solve(r,e){return Y(this.url,r,e)}};i([o()],B.prototype,"url",void 0),B=i([N("esri.tasks.ClosestFacilityTask")],B);const ne=B;export{ne as default};
