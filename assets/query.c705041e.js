var j=Object.defineProperty,P=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var S=(i,e,n)=>e in i?j(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,l=(i,e)=>{for(var n in e||(e={}))R.call(e,n)&&S(i,n,e[n]);if(x)for(var n of x(e))N.call(e,n)&&S(i,n,e[n]);return i},p=(i,e)=>P(i,q(e));import{E as a,M as J,aq as z,N as b,aj as w,ak as h,O as v}from"./vendor.b8b0b9ef.js";import{v as B}from"./normalizeUtils.7353462f.js";import{t as I}from"./pbfQueryUtils.01cf3cd9.js";function O(i){const e={};for(const n in i){if(n==="declaredClass")continue;const r=i[n];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[n]=[];for(let t=0;t<r.length;t++)e[n][t]=O(r[t])}else typeof r=="object"?r.toJSON&&(e[n]=JSON.stringify(r)):e[n]=r}return e}const g="Layer does not support extent calculation.";function E(i,e,n=!1){const r=i.geometry,t=i.toJSON(),o=t,d=i.outSpatialReference;let s,f;if(a(r)){if(s=r.spatialReference,f=r.spatialReference.wkid||JSON.stringify(r.spatialReference),o.geometryType=J(r),n&&r.type==="extent")o.geometry=`${r.xmin},${r.ymin},${r.xmax},${r.ymax}`;else if(n&&r.type==="point")o.geometry=`${r.x},${r.y}`;else{const y=r.toJSON();delete y.spatialReference,o.geometry=JSON.stringify(y)}o.inSR=f}if(s||(s=d),t.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=t.groupByFieldsForStatistics.join(",")),t.objectIds&&(o.objectIds=t.objectIds.join(",")),t.orderByFields&&(o.orderByFields=t.orderByFields.join(",")),!t.outFields||!t.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete o.outFields:t.outFields.indexOf("*")!==-1?o.outFields="*":o.outFields=t.outFields.join(","),t.outSR?o.outSR=t.outSR.wkid||JSON.stringify(t.outSR):r&&(t.returnGeometry||t.returnCentroid)&&(o.outSR=o.inSR),t.returnGeometry&&delete t.returnGeometry,t.outStatistics&&(o.outStatistics=JSON.stringify(t.outStatistics)),t.pixelSize&&(o.pixelSize=JSON.stringify(t.pixelSize)),t.quantizationParameters&&(n&&a(s)&&a(i.quantizationParameters)&&a(i.quantizationParameters.extent)&&s.equals(i.quantizationParameters.extent.spatialReference)&&delete t.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(t.quantizationParameters)),t.parameterValues&&(o.parameterValues=JSON.stringify(t.parameterValues)),t.rangeValues&&(o.rangeValues=JSON.stringify(t.rangeValues)),t.dynamicDataSource&&(o.layer=JSON.stringify({source:t.dynamicDataSource}),delete t.dynamicDataSource),t.timeExtent){const y=t.timeExtent,{start:u,end:m}=y;u==null&&m==null||(o.time=u===m?u:`${u==null?"null":u},${m==null?"null":m}`),delete t.timeExtent}return o}async function Q(i,e,n,r){const t=a(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await c(i,e,"json",r);return h(e,n,t.data),t}async function C(i,e,n,r){if(a(e.timeExtent)&&e.timeExtent.isEmpty)return Promise.resolve({data:n.createFeatureResult()});const t=await F(i,e,r),o=t;return o.data=I(t.data,n),o}function F(i,e,n){return c(i,e,"pbf",n)}function V(i,e,n){return a(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c(i,e,"json",n,{returnIdsOnly:!0})}function D(i,e,n){return a(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c(i,e,"json",n,{returnIdsOnly:!0,returnCountOnly:!0})}function T(i,e,n){return a(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):c(i,e,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const t=r.data;if(t.hasOwnProperty("extent"))return r;if(t.features)throw new Error(g);if(t.hasOwnProperty("count"))throw new Error(g);return r})}function c(i,e,n,r={},t={}){const o=typeof i=="string"?v(i):i,d=e.geometry?[e.geometry]:[];return r.responseType=n==="pbf"?"array-buffer":"json",B(d,null,r).then(s=>{const f=s&&s[0];a(f)&&((e=e.clone()).geometry=f);const y=z(o.path),u=O(l(l(p(l({},o.query),{f:n}),t),E(e,t,y)));return b(w(o.path,"query"),p(l({},r),{query:l(l({},u),r.query)}))})}var M=Object.freeze(Object.defineProperty({__proto__:null,executeQuery:Q,executeQueryForCount:D,executeQueryForExtent:T,executeQueryForIds:V,executeQueryPBF:C,executeQueryPBFBuffer:F,queryToQueryStringParameters:E,runQuery:c},Symbol.toStringTag,{value:"Module"}));export{T as S,Q as c,V as d,F as f,C as p,M as q,O as t,D as x};
